/**
 * Copyright (c) 2015 pointofpresence
 * ReSampled.Pixla (pixla) - Creative online image filter
 * @version v0.1.11
 * @build Sun Jul 12 2015 14:09:10
 * @link https://github.com/pointofpresence/pixla
 * @license MIT
 */
define("lib/Buffer",["lib/Canvas"],function(Canvas){"use strict";return{COLORS:{BLACK:[0,0,0,255],WHITE:[255,255,255,255]},grab:function(data,srcW,srcH,dstX,dstY,dstW,dstH){var tempCvs=Canvas.createEmptyCanvas(srcW,srcH),tempCtx=tempCvs.getContext("2d"),tempIData=tempCtx.createImageData(srcW,srcH);return tempIData.data.set(data),tempCtx.putImageData(tempIData,0,0),tempCtx.getImageData(Math.floor(dstX),Math.floor(dstY),Math.floor(dstW),Math.floor(dstH)).data},draw:function(srcData,srcW,srcH,destData,destX,destY,destW,destH){var tempCvs=Canvas.createEmptyCanvas(destW,destH),tempCtx=tempCvs.getContext("2d"),tempSrcIData=tempCtx.createImageData(srcW,srcH),tempDestIData=tempCtx.createImageData(destW,destH);return tempDestIData.data.set(destData),tempCtx.putImageData(tempDestIData,0,0),tempSrcIData.data.set(srcData),tempCtx.putImageData(tempSrcIData,destX,destY),tempCtx.getImageData(0,0,destW,destH).data},getPixel:function(data,index){var i=4*index;return[data[i],data[i+1],data[i+2],data[i+3]]},getPixelXY:function(data,x,y,w){return this.getPixel(data,Math.floor(y*w+x))},setPixel:function(data,index,color){var i=4*index;data[i]=color[0],data[i+1]=color[1],data[i+2]=color[2],data[i+3]=color[3]},setPixelXY:function(data,x,y,color,w){return x>=w?void 0:this.setPixel(data,y*w+x,color)},mixColors:function(color1,color2,percent){var n=percent||.5,R=Math.round((color2[0]-color1[0])*n)+color1[0],G=Math.round((color2[1]-color1[1])*n)+color1[1],B=Math.round((color2[2]-color1[2])*n)+color1[2],A=Math.round((color2[3]-color1[3])*n)+color1[3];return[R,G,B,A]},setMixPixel:function(data,x,y,blendColor,w){var oc=this.getPixelXY(data,x,y,w),n=blendColor[3]/255,n2=1-n;this.setPixelXY(data,x,y,[Math.floor(oc[0]*n2+blendColor[0]*n),Math.floor(oc[1]*n2+blendColor[1]*n),Math.floor(oc[2]*n2+blendColor[2]*n),oc[3]],w)},setShadeBlendPixel:function(data,x,y,percent,blendColor,w){var oc=this.getPixelXY(data,x,y,w),n=0>percent?-1*percent:percent;blendColor=blendColor?blendColor:0>percent?[0,0,0,oc[3]]:[255,255,255,oc[3]];var R=Math.round((blendColor[0]-oc[0])*n)+oc[0],G=Math.round((blendColor[1]-oc[1])*n)+oc[1],B=Math.round((blendColor[2]-oc[2])*n)+oc[2],A=Math.round((blendColor[3]-oc[3])*n)+oc[3];this.setPixelXY(data,x,y,[R,G,B,A],w)},componentToHex:function(c){var hex=c.toString(16);return 1==hex.length?"0"+hex:hex},rgbaToHex:function(color){return this.componentToHex(color[0])+this.componentToHex(color[1])+this.componentToHex(color[2])+this.componentToHex(color[3])},hsvToRgb:function(h,s,v){var r,g,b,i=Math.floor(6*h),f=6*h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}return[255*r,255*g,255*b]},rgbToHsv:function(r,g,b){r/=255,g/=255,b/=255;var h,s,max=Math.max(r,g,b),min=Math.min(r,g,b),v=max,d=max-min;if(s=0===max?0:d/max,max===min)h=0;else{switch(max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return[h,s,v]}}}),define("lib/Canvas",[],function(){"use strict";return{createEmptyCanvas:function(w,h,id){var canvas=document.createElement("canvas");return canvas.width=w,canvas.height=h,id&&(canvas.id=id),canvas},convertImageToCanvas:function(image){var canvas=this.createEmptyCanvas(image.width,image.height);return canvas.getContext("2d").drawImage(image,0,0),canvas},convertCanvasToImage:function(canvas,callback){var image=new Image;image.onload=function(){callback(image)},image.src=canvas.toDataURL("image/png")},createEmptyBuffer:function(w,h){var cvs=document.createElement("canvas");cvs.width=w,cvs.height=h;var ctx=cvs.getContext("2d");return ctx.getImageData(0,0,cvs.width,cvs.height)}}}),define("lib/Dithering",[],function(){"use strict";return{opt:{},ALGORITHM:{REDUCE:"Reduce",ORDERED:"Ordered",ERROR:"Error diffusion",ATKINSON:"Atkinson"},PALETTE:{C64:{name:"C64",data:[[0,0,0],[102,102,204],[102,204,204],[153,255,153],[204,102,102],[204,204,102],[255,255,255],[51,51,153],[102,51,0],[102,102,102],[102,153,51],[153,51,51],[153,51,153],[153,102,51],[153,153,153]]},BASIC:{name:"Basic",data:[[0,0,0],[255,0,255],[0,255,255],[255,255,255]]},SPECTRUM:{name:"ZX Spectrum",data:[[0,0,0],[0,0,255],[0,255,0],[0,255,255],[255,0,0],[255,0,255],[255,255,0],[255,255,255]]},MONO:{name:"Monochrome",data:[[0,0,0],[255,255,255]]},AMIGA_ORANGE:{name:"Amiga Orange",data:[[0,0,0],[0,0,51],[0,51,51],[102,102,204],[102,153,255],[204,102,51],[204,153,51],[204,153,153],[204,204,204],[255,153,102],[255,204,102],[255,204,153],[255,204,204],[51,0,0],[51,51,0],[51,51,51],[51,51,102],[51,51,153],[51,102,102],[51,102,153],[102,0,0],[102,51,0],[102,51,51],[102,102,51],[102,102,102],[153,51,0],[153,102,51],[153,153,153]]},AMIGA_BRONZE:{name:"Amiga Bronze",data:[[0,0,0],[204,102,51],[204,153,51],[204,153,102],[204,153,153],[204,204,153],[204,204,204],[255,153,102],[255,204,153],[255,204,204],[255,255,255],[51,0,0],[51,51,0],[51,51,51],[102,51,0],[102,51,51],[102,102,51],[102,102,102],[153,51,0],[153,102,51],[153,102,102],[153,153,102],[153,153,153]]}},dither:function(data,w,h,opt){switch(opt=opt||{},this.opt.step=opt.step||1,this.opt.algorithm=opt.algorithm||this.ALGORITHM.REDUCE,this.opt.palette=opt.palette.data||this.PALETTE.BASIC.data,this.w=w,this.h=h,this.opt.algorithm){case this.ALGORITHM.ERROR:return this.errorDiffusionDither(data);case this.ALGORITHM.ORDERED:return this.orderedDither(data);case this.ALGORITHM.ATKINSON:return this.atkinsonDither(data);case this.ALGORITHM.REDUCE:return this.reduceDither(data);default:throw new Error("Not a valid algorithm")}},colorDistance:function(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))},approximateColor:function(color){var palette=this.opt.palette,findIndex=function(fun,arg,list,min){if(2==list.length)return fun(arg,min)<=fun(arg,list[1])?min:list[1];var tl=list.slice(1);return min=fun(arg,min)<=fun(arg,list[1])?min:list[1],findIndex(fun,arg,tl,min)};return findIndex(this.colorDistance,color,palette,palette[0])},threshold:function(value){return 127>value?0:255},orderedDither:function(data){for(var d=new Uint8ClampedArray(data),w=this.w,h=this.h,step=this.opt.step,ratio=3,m=[[1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]],y=0;h>y;y+=step)for(var x=0;w>x;x+=step){var i=4*x+4*y*w,r=i,g=i+1,b=i+2;d[r]+=m[x%4][y%4]*ratio,d[g]+=m[x%4][y%4]*ratio,d[b]+=m[x%4][y%4]*ratio;for(var color=[d[r],d[g],d[b]],approx=this.approximateColor(color),tr=approx[0],tg=approx[1],tb=approx[2],dx=0;step>dx;dx++)for(var dy=0;step>dy;dy++){var di=i+4*dx+4*w*dy;d[di]=tr,d[di+1]=tg,d[di+2]=tb}}return d},reduceDither:function(data){for(var d=new Uint8ClampedArray(data),w=this.w,h=this.h,step=this.opt.step,y=0;h>y;y+=step)for(var x=0;w>x;x+=step)for(var i=4*x+4*y*w,r=i,g=i+1,b=i+2,color=[d[r],d[g],d[b]],approx=this.approximateColor(color),tr=approx[0],tg=approx[1],tb=approx[2],dx=0;step>dx;dx++)for(var dy=0;step>dy;dy++){var di=i+4*dx+4*w*dy;d[di]=tr,d[di+1]=tg,d[di+2]=tb}return d},atkinsonDither:function(data){for(var d=new Uint8ClampedArray(data),out=new Uint8ClampedArray(data),w=this.w,h=this.h,step=this.opt.step,ratio=1/8,y=0;h>y;y+=step)for(var x=0;w>x;x+=step){var i=4*x+4*y*w,$i=function(x,y){return 4*x+4*y*w},r=i,g=i+1,b=i+2,color=[d[r],d[g],d[b]],approx=this.approximateColor(color),q=[];q[r]=d[r]-approx[0],q[g]=d[g]-approx[1],q[b]=d[b]-approx[2],d[$i(x+step,y)+0]+=ratio*q[r],d[$i(x-step,y+step)+0]+=ratio*q[r],d[$i(x,y+step)+0]+=ratio*q[r],d[$i(x+step,y+step)+0]+=ratio*q[r],d[$i(x+2*step,y)+0]+=ratio*q[r],d[$i(x,y+2*step)+0]+=ratio*q[r],d[$i(x+step,y)+1]+=ratio*q[r],d[$i(x-step,y+step)+1]+=ratio*q[r],d[$i(x,y+step)+1]+=ratio*q[r],d[$i(x+step,y+step)+1]+=ratio*q[r],d[$i(x+2*step,y)+1]+=ratio*q[r],d[$i(x,y+2*step)+1]+=ratio*q[r],d[$i(x+step,y)+2]+=ratio*q[r],d[$i(x-step,y+step)+2]+=ratio*q[r],d[$i(x,y+step)+2]+=ratio*q[r],d[$i(x+step,y+step)+2]+=ratio*q[r],d[$i(x+2*step,y)+2]+=ratio*q[r],d[$i(x,y+2*step)+2]+=ratio*q[r];for(var tr=approx[0],tg=approx[1],tb=approx[2],dx=0;step>dx;dx++)for(var dy=0;step>dy;dy++){var di=i+4*dx+4*w*dy;out[di]=tr,out[di+1]=tg,out[di+2]=tb}}return out},errorDiffusionDither:function(data){for(var d=new Uint8ClampedArray(data),out=new Uint8ClampedArray(data),w=this.w,h=this.h,step=this.opt.step,ratio=1/16,y=0;h>y;y+=step)for(var x=0;w>x;x+=step){var i=4*x+4*y*w,$i=function(x,y){return 4*x+4*y*w},r=i,g=i+1,b=i+2,color=[d[r],d[g],d[b]],approx=this.approximateColor(color),q=[];q[r]=d[r]-approx[0],q[g]=d[g]-approx[1],q[b]=d[b]-approx[2],d[$i(x+step,y)]=d[$i(x+step,y)]+7*ratio*q[r],d[$i(x-step,y+1)]=d[$i(x-1,y+step)]+3*ratio*q[r],d[$i(x,y+step)]=d[$i(x,y+step)]+5*ratio*q[r],d[$i(x+step,y+step)]=d[$i(x+1,y+step)]+1*ratio*q[r],d[$i(x+step,y)+1]=d[$i(x+step,y)+1]+7*ratio*q[g],d[$i(x-step,y+step)+1]=d[$i(x-step,y+step)+1]+3*ratio*q[g],d[$i(x,y+step)+1]=d[$i(x,y+step)+1]+5*ratio*q[g],d[$i(x+step,y+step)+1]=d[$i(x+step,y+step)+1]+1*ratio*q[g],d[$i(x+step,y)+2]=d[$i(x+step,y)+2]+7*ratio*q[b],d[$i(x-step,y+step)+2]=d[$i(x-step,y+step)+2]+3*ratio*q[b],d[$i(x,y+step)+2]=d[$i(x,y+step)+2]+5*ratio*q[b],d[$i(x+step,y+step)+2]=d[$i(x+step,y+step)+2]+1*ratio*q[b];for(var tr=approx[0],tg=approx[1],tb=approx[2],dx=0;step>dx;dx++)for(var dy=0;step>dy;dy++){var di=i+4*dx+4*w*dy;out[di]=tr,out[di+1]=tg,out[di+2]=tb}}return out}}}),define("lib/Fileinput",["jquery"],function($){"use strict";var b=function(d,e){this.options=e,this.$elementFilestyle=[],this.$element=$(d)};b.prototype={clear:function(){this.$element.val(""),this.$elementFilestyle.find(":text").val(""),this.$elementFilestyle.find(".badge").remove()},destroy:function(){this.$element.removeAttr("style").removeData("filestyle").val(""),this.$elementFilestyle.remove()},disabled:function(d){if(d===!0)this.options.disabled||(this.$element.attr("disabled","true"),this.$elementFilestyle.find("label").attr("disabled","true"),this.options.disabled=!0);else{if(d!==!1)return this.options.disabled;this.options.disabled&&(this.$element.removeAttr("disabled"),this.$elementFilestyle.find("label").removeAttr("disabled"),this.options.disabled=!1)}},buttonBefore:function(d){if(d===!0)this.options.buttonBefore||(this.options.buttonBefore=!0,this.options.input&&(this.$elementFilestyle.remove(),this.constructor(),this.pushNameFiles()));else{if(d!==!1)return this.options.buttonBefore;this.options.buttonBefore&&(this.options.buttonBefore=!1,this.options.input&&(this.$elementFilestyle.remove(),this.constructor(),this.pushNameFiles()))}},icon:function(d){if(d===!0)this.options.icon||(this.options.icon=!0,this.$elementFilestyle.find("label").prepend(this.htmlIcon()));else{if(d!==!1)return this.options.icon;this.options.icon&&(this.options.icon=!1,this.$elementFilestyle.find(".glyphicon").remove())}},input:function(e){if(e===!0)this.options.input||(this.options.input=!0,this.options.buttonBefore?this.$elementFilestyle.append(this.htmlInput()):this.$elementFilestyle.prepend(this.htmlInput()),this.$elementFilestyle.find(".badge").remove(),this.pushNameFiles(),this.$elementFilestyle.find(".group-span-filestyle").addClass("input-group-btn"));else{if(e!==!1)return this.options.input;if(this.options.input){this.options.input=!1,this.$elementFilestyle.find(":text").remove();var d=this.pushNameFiles();d.length>0&&this.options.badge&&this.$elementFilestyle.find("label").append(' <span class="badge">'+d.length+"</span>"),this.$elementFilestyle.find(".group-span-filestyle").removeClass("input-group-btn")}}},size:function(d){if(void 0===d)return this.options.size;var f=this.$elementFilestyle.find("label"),e=this.$elementFilestyle.find("input");f.removeClass("btn-lg btn-sm"),e.removeClass("input-lg input-sm"),"nr"!=d&&(f.addClass("btn-"+d),e.addClass("input-"+d))},buttonText:function(d){return void 0===d?this.options.buttonText:(this.options.buttonText=d,void this.$elementFilestyle.find("label span").html(this.options.buttonText))},buttonName:function(d){return void 0===d?this.options.buttonName:(this.options.buttonName=d,void this.$elementFilestyle.find("label").attr({"class":"btn "+this.options.buttonName}))},iconName:function(d){return void 0===d?this.options.iconName:void this.$elementFilestyle.find(".glyphicon").attr({"class":".glyphicon "+this.options.iconName})},htmlIcon:function(){return this.options.icon?'<span class="glyphicon '+this.options.iconName+'"></span> ':""},htmlInput:function(){return this.options.input?'<input type="text" class="form-control '+("nr"==this.options.size?"":"input-"+this.options.size)+'" disabled> ':""},pushNameFiles:function(){var d="",f=[];void 0===this.$element[0].files?f[0]={name:this.$element[0]&&this.$element[0].value}:f=this.$element[0].files;for(var e=0;e<f.length;e++)d+=f[e].name.split("\\").pop()+", ";return this.$elementFilestyle.find(":text").val(""!==d?d.replace(/\, $/g,""):""),f},constructor:function(){var h=this,f="",g=h.$element.attr("id"),i="";""!==g&&g||(g="filestyle-"+$(".bootstrap-filestyle").length,h.$element.attr({id:g})),i='<span class="group-span-filestyle '+(h.options.input?"input-group-btn":"")+'"><label for="'+g+'" class="btn '+h.options.buttonName+" "+("nr"==h.options.size?"":"btn-"+h.options.size)+'" '+(h.options.disabled?'disabled="true"':"")+">"+h.htmlIcon()+h.options.buttonText+"</label></span>",f=h.options.buttonBefore?i+h.htmlInput():h.htmlInput()+i,h.$elementFilestyle=$('<div class="bootstrap-filestyle input-group">'+f+"</div>"),h.$elementFilestyle.find(".group-span-filestyle").attr("tabindex","0").keypress(function(j){return 13===j.keyCode||32===j.charCode?(h.$elementFilestyle.find("label").click(),!1):void 0}),h.$element.css({position:"absolute",clip:"rect(0px 0px 0px 0px)"}).attr("tabindex","-1").after(h.$elementFilestyle),h.options.disabled&&h.$element.attr("disabled","true"),h.$element.change(function(){var j=h.pushNameFiles();0==h.options.input&&h.options.badge?0==h.$elementFilestyle.find(".badge").length?h.$elementFilestyle.find("label").append(' <span class="badge">'+j.length+"</span>"):0==j.length?h.$elementFilestyle.find(".badge").remove():h.$elementFilestyle.find(".badge").html(j.length):h.$elementFilestyle.find(".badge").remove()}),window.navigator.userAgent.search(/firefox/i)>-1&&h.$elementFilestyle.find("label").click(function(){return h.$element.click(),!1})}};var a=$.fn.filestyle;$.fn.filestyle=function(e,d){var f="",g=this.each(function(){if("file"===$(this).attr("type")){var j=$(this),h=j.data("filestyle"),i=$.extend({},$.fn.filestyle.defaults,e,"object"==typeof e&&e);h||(j.data("filestyle",h=new b(this,i)),h.constructor()),"string"==typeof e&&(f=h[e](d))}});return"undefined"!=typeof f?f:g},$.fn.filestyle.defaults={buttonText:"Choose file",iconName:"glyphicon-folder-open",buttonName:"btn-default",size:"nr",input:!0,badge:!0,icon:!0,buttonBefore:!1,disabled:!1},$.fn.filestyle.noConflict=function(){return $.fn.filestyle=a,this},$(function(){$(".filestyle").each(function(){var e=$(this),d={input:"false"!==e.attr("data-input"),icon:"false"!==e.attr("data-icon"),buttonBefore:"true"===e.attr("data-buttonBefore"),disabled:"true"===e.attr("data-disabled"),size:e.attr("data-size"),buttonText:e.attr("data-buttonText"),buttonName:e.attr("data-buttonName"),iconName:e.attr("data-iconName"),badge:"false"!==e.attr("data-badge")};e.filestyle(d)})})}),define("lib/Filter",["underscore","lib/Dithering","lib/Buffer","lib/Mixin"],function(_,Dithering,Buffer){"use strict";return{emboss:function(data,w,h,bumpHeight,angle,elevation){angle=angle||135,elevation=elevation||30,angle=angle/180*Math.PI,elevation=elevation/180*Math.PI;for(var width45=3*bumpHeight,pixelScale=255.9,bumpPixels=[],bumpMapWidth=w,i=0;i<data.length;i+=4)bumpPixels[i/4]=(data[i]+data[i+1]+data[i+2])/3;var Nx,Ny,Nz,Lx,Ly,Lz,Nz2,NzLz,NdotL,shade,background;Lx=Math.floor(Math.cos(angle)*Math.cos(elevation)*pixelScale),Ly=Math.floor(Math.sin(angle)*Math.cos(elevation)*pixelScale),Lz=Math.floor(Math.sin(elevation)*pixelScale),Nz=Math.floor(1530/width45),Nz2=Nz*Nz,NzLz=Nz*Lz,background=Lz;for(var bumpIndex=0,y=0;h>y;y++,bumpIndex+=bumpMapWidth)for(var s1=bumpIndex,s2=s1+bumpMapWidth,s3=s2+bumpMapWidth,x=0;w>x;x++,s1++,s2++,s3++){var pixel=4*(y*w+x);0!=y&&h-2>y&&0!=x&&w-2>x?(Nx=bumpPixels[s1-1]+bumpPixels[s2-1]+bumpPixels[s3-1]-bumpPixels[s1+1]-bumpPixels[s2+1]-bumpPixels[s3+1],Ny=bumpPixels[s3-1]+bumpPixels[s3]+bumpPixels[s3+1]-bumpPixels[s1-1]-bumpPixels[s1]-bumpPixels[s1+1],shade=0==Nx&&0==Ny?background:(NdotL=Nx*Lx+Ny*Ly+NzLz)<0?0:Math.floor(NdotL/Math.sqrt(Nx*Nx+Ny*Ny+Nz2))):shade=background,data[pixel]=data[pixel+1]=data[pixel+2]=shade}return data},saturation:function(data,w,h,amount){for(var RW=.3086,RG=.6084,RB=.082,a=(1-amount)*RW+amount,b=(1-amount)*RW,c=(1-amount)*RW,d=(1-amount)*RG,e=(1-amount)*RG+amount,f=(1-amount)*RG,g=(1-amount)*RB,k=(1-amount)*RB,i=(1-amount)*RB+amount,y=0;h>y;y++)for(var x=0;w>x;x++){var pixel=4*(y*w+x);data[pixel]=a*data[pixel]+d*data[pixel+1]+g*data[pixel+2],data[pixel+1]=b*data[pixel]+e*data[pixel+1]+k*data[pixel+2],data[pixel+2]=c*data[pixel]+f*data[pixel+1]+i*data[pixel+2]}return data},blur:function(data,w,h,amount){var q,width4=w<<2;0>amount&&(amount=0),q=amount>=2.5?.98711*amount-.9633:amount>=.5?3.97156-4.14554*Math.sqrt(1-.26891*amount):2*amount*(3.97156-4.14554*Math.sqrt(.865545));var index,indexLast,pixel,ppixel,pppixel,ppppixel,c,qq=q*q,qqq=qq*q,b0=1.57825+2.44413*q+1.4281*qq+.422205*qqq,b1=(2.44413*q+2.85619*qq+1.26661*qqq)/b0,b2=-(1.4281*qq+1.26661*qqq)/b0,b3=.422205*qqq/b0,bigB=1-(b1+b2+b3);for(c=0;3>c;c++)for(var y=0;h>y;y++){for(index=y*width4+c,indexLast=y*width4+(w-1<<2)+c,pixel=data[index],ppixel=pixel,pppixel=ppixel,ppppixel=pppixel;indexLast>=index;index+=4)pixel=bigB*data[index]+b1*ppixel+b2*pppixel+b3*ppppixel,data[index]=pixel,ppppixel=pppixel,pppixel=ppixel,ppixel=pixel;for(index=y*width4+(w-1<<2)+c,indexLast=y*width4+c,pixel=data[index],ppixel=pixel,pppixel=ppixel,ppppixel=pppixel;index>=indexLast;index-=4)pixel=bigB*data[index]+b1*ppixel+b2*pppixel+b3*ppppixel,data[index]=pixel,ppppixel=pppixel,pppixel=ppixel,ppixel=pixel}for(c=0;3>c;c++)for(var x=0;w>x;x++){for(index=(x<<2)+c,indexLast=(h-1)*width4+(x<<2)+c,pixel=data[index],ppixel=pixel,pppixel=ppixel,ppppixel=pppixel;indexLast>=index;index+=width4)pixel=bigB*data[index]+b1*ppixel+b2*pppixel+b3*ppppixel,data[index]=pixel,ppppixel=pppixel,pppixel=ppixel,ppixel=pixel;for(index=(h-1)*width4+(x<<2)+c,indexLast=(x<<2)+c,pixel=data[index],ppixel=pixel,pppixel=ppixel,ppppixel=pppixel;index>=indexLast;index-=width4)pixel=bigB*data[index]+b1*ppixel+b2*pppixel+b3*ppppixel,data[index]=pixel,ppppixel=pppixel,pppixel=ppixel,ppixel=pixel}return data},hue:function(data,w,h,amount){for(var y=0;h>y;y++)for(var x=0;w>x;x++){var pixel=4*(y*w+x),hsv=Buffer.rgbToHsv(data[pixel],data[pixel+1],data[pixel+2]);for(hsv[0]+=amount;hsv[0]<0;)hsv[0]+=360;for(var rgb=Buffer.hsvToRgb(hsv[0],hsv[1],hsv[2]),i=0;3>i;i++)data[pixel+i]=rgb[i]}return data},contrast:function(data,contrast){for(var factor=259*(contrast+255)/(255*(259-contrast)),i=0;i<data.length;i+=4)data[i]=factor*(data[i]-128)+128,data[i+1]=factor*(data[i+1]-128)+128,data[i+2]=factor*(data[i+2]-128)+128;return data},zhangSuen:function(data,w,h){function Image2Bool(img,width,height){for(var s=[],y=0;height>y;y++){for(var sx=[],x=0;width>x;x++){var p=Buffer.getPixelXY(img,x,y,w);if(0==x||0==y||x==width-1||y==height-1)sx.push(!1);else{var v=Math.floor((p[0]+p[1]+p[2])/3);sx.push(32>v)}}s.push(sx)}return s}function Bool2Image(s,width,height){for(var bmp=new Uint8ClampedArray(width*height*4),y=0;height>y;y++)for(var x=0;width>x;x++)s[y][x]?Buffer.setPixelXY(bmp,x,y,Buffer.COLORS.BLACK,w):Buffer.setPixelXY(bmp,x,y,Buffer.COLORS.WHITE,w);return bmp}function NumberOfNonZeroNeighbors(x,y,s){var count=0;return s[x-1][y]&&count++,s[x-1][y+1]&&count++,s[x-1][y-1]&&count++,s[x][y+1]&&count++,s[x][y-1]&&count++,s[x+1][y]&&count++,s[x+1][y+1]&&count++,s[x+1][y-1]&&count++,count}function NumberOfZeroToOneTransitionFromP9(x,y,s){var p2=s[x][y-1],p3=s[x+1][y-1],p4=s[x+1][y],p5=s[x+1][y+1],p6=s[x][y+1],p7=s[x-1][y+1],p8=s[x-1][y],p9=s[x-1][y-1];return+(!p2&&p3)+ +(!p3&&p4)+ +(!p4&&p5)+ +(!p5&&p6)+ +(!p6&&p7)+ +(!p7&&p8)+ +(!p8&&p9)+ +(!p9&&p2)}function SuenThinningAlg(x,y,s,even){var p2=s[x][y-1],p4=s[x+1][y],p6=s[x][y+1],p8=s[x-1][y],bp1=NumberOfNonZeroNeighbors(x,y,s);if(bp1>=2&&6>=bp1&&1==NumberOfZeroToOneTransitionFromP9(x,y,s))if(even){if(!(p2&&p4&&p8||p2&&p6&&p8))return!0}else if(!(p2&&p4&&p6||p4&&p6&&p8))return!0;return!1}function step(stepNo,temp,s){for(var count=0,a=1;a<temp.length-1;a++)for(var b=1;b<temp[0].length-1;b++)SuenThinningAlg(a,b,temp,2==stepNo)&&(s[a][b]&&count++,s[a][b]=!1);return count}function ZhangSuenThinning(img,width,height){var temp,s=Image2Bool(img,width,height),count=0;do temp=_.deepClone(s),count=step(1,temp,s),temp=_.deepClone(s),count+=step(2,temp,s);while(count>0);return Bool2Image(s,width,height)}return ZhangSuenThinning(data,w,h)},kaleidoskopeCenter:function(data,srcW,srcH){data=Buffer.grab(data,srcW,srcH,0,0,srcW,srcH);var w=Math.floor(srcW/2),h=Math.floor(srcH/2),block=Buffer.grab(data,srcW,srcH,0,0,w,h);return data=Buffer.draw(block,w,h,data,0,0,srcW,srcH),block=this.flipX(block,w,h),data=Buffer.draw(block,w,h,data,w,0,srcW,srcH),block=this.flipY(block,w,h),data=Buffer.draw(block,w,h,data,w,h,srcW,srcH),block=this.flipX(block,w,h),data=Buffer.draw(block,w,h,data,0,h,srcW,srcH)},kaleidoskopeCenterOutside:function(data,srcW,srcH){data=Buffer.grab(data,srcW,srcH,0,0,srcW,srcH);var w=Math.floor(srcW/2),h=Math.floor(srcH/2),block=Buffer.grab(data,srcW,srcH,0,0,w,h);return data=Buffer.draw(block,w,h,data,0,0,srcW,srcH),block=this.flipY(block,w,h),data=Buffer.draw(block,w,h,data,w,0,srcW,srcH),block=this.flipX(block,w,h),data=Buffer.draw(block,w,h,data,w,h,srcW,srcH),block=this.flipY(block,w,h),data=Buffer.draw(block,w,h,data,0,h,srcW,srcH)},kaleidoskopeOutside:function(data,srcW,srcH){data=Buffer.grab(data,srcW,srcH,0,0,srcW,srcH);var w=Math.floor(srcW/2),h=Math.floor(srcH/2),block=Buffer.grab(data,srcW,srcH,0,0,w,h);return block=this.flipX(block,w,h),data=Buffer.draw(block,w,h,data,0,0,srcW,srcH),block=this.flipX(block,w,h),data=Buffer.draw(block,w,h,data,w,0,srcW,srcH),block=this.flipY(block,w,h),data=Buffer.draw(block,w,h,data,w,h,srcW,srcH),block=this.flipX(block,w,h),data=Buffer.draw(block,w,h,data,0,h,srcW,srcH)},kaleidoskopeVert:function(data,srcW,srcH){data=Buffer.grab(data,srcW,srcH,0,0,srcW,srcH);var h=Math.floor(srcH/2),block=Buffer.grab(data,srcW,srcH,0,0,srcW,h);return data=Buffer.draw(block,srcW,h,data,0,0,srcW,srcH),block=this.flipY(block,srcW,h),data=Buffer.draw(block,srcW,h,data,0,h,srcW,srcH)},kaleidoskopeCard:function(data,srcW,srcH){data=Buffer.grab(data,srcW,srcH,0,0,srcW,srcH);var h=Math.floor(srcH/2),block=Buffer.grab(data,srcW,srcH,0,0,srcW,h);return data=Buffer.draw(block,srcW,h,data,0,0,srcW,srcH),block=this.flipY(block,srcW,h),block=this.flipX(block,srcW,h),data=Buffer.draw(block,srcW,h,data,0,h,srcW,srcH)},kaleidoskopeHoriz:function(data,srcW,srcH){data=Buffer.grab(data,srcW,srcH,0,0,srcW,srcH);var w=Math.floor(srcW/2),block=Buffer.grab(data,srcW,srcH,0,0,w,srcH);return data=Buffer.draw(block,w,srcH,data,0,0,srcW,srcH),block=this.flipX(block,w,srcH),data=Buffer.draw(block,w,srcH,data,w,0,srcW,srcH)},sobel:function(data,w){for(var grayscale=this.grayscale(data),vertical=this.convolve3x3(grayscale,w,[-1,0,1,-2,0,2,-1,0,1]),horizontal=this.convolve3x3(grayscale,w,[-1,-2,-1,0,0,0,1,2,1]),newData=new Uint8ClampedArray(data.length),i=0;i<data.length;i+=4){var v=Math.abs(vertical[i]);newData[i]=v;var h=Math.abs(horizontal[i]);newData[i+1]=h,newData[i+2]=(v+h)/4,newData[i+3]=255}return newData},convolute:function(data,w,h,weights,opaque){opaque=opaque||!1;for(var side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),dst=new Uint8ClampedArray(data.length),alphaFac=+opaque,y=0;h>y;y++)for(var x=0;w>x;x++){for(var sy=y,sx=x,dstOff=4*(y*w+x),r=0,g=0,b=0,a=0,cy=0;side>cy;cy++)for(var cx=0;side>cx;cx++){var scy=sy+cy-halfSide,scx=sx+cx-halfSide;if(scy>=0&&h>scy&&scx>=0&&w>scx){var srcOff=4*(scy*w+scx),wt=weights[cy*side+cx];r+=data[srcOff]*wt,g+=data[srcOff+1]*wt,b+=data[srcOff+2]*wt,a+=data[srcOff+3]*wt}}dst[dstOff]=r,dst[dstOff+1]=g,dst[dstOff+2]=b,dst[dstOff+3]=a+alphaFac*(255-a)}return dst},convolve3x3:function(data,w,m,divisor,offset){divisor||(divisor=m.reduce(function(a,b){return a+b})||1);for(var newData=new Uint8ClampedArray(data.length),len=newData.length,res=0,i=0;len>i;i++)if((i+1)%4!==0){res=0;for(var these=[data[i-4*w-4]||data[i],data[i-4*w]||data[i],data[i-4*w+4]||data[i],data[i-4]||data[i],data[i],data[i+4]||data[i],data[i+4*w-4]||data[i],data[i+4*w]||data[i],data[i+4*w+4]||data[i]],j=0;9>j;j++)res+=these[j]*m[j];res/=divisor,offset&&(res+=offset),newData[i]=res}else newData[i]=data[i];return newData},invert:function(data){for(var i=0;i<data.length;i+=4)data[i]=255-data[i],data[i+1]=255-data[i+1],data[i+2]=255-data[i+2];return data},flipX:function(data,w,h){var i,flip,x,y,c,tempData=_.deepClone(data);for(y=0;h>y;y++)for(x=0;w>x;x++)for(i=4*(y*w+x),flip=4*(y*w+(w-x-1)),c=0;4>c;c++)tempData[i+c]=data[flip+c];return tempData},flipY:function(data,w,h){var i,flip,x,y,c,tempData=_.deepClone(data);for(y=0;h>y;y++)for(x=0;w>x;x++)for(i=4*(y*w+x),flip=4*((h-y-1)*w+x),c=0;4>c;c+=1)tempData[i+c]=data[flip+c];return tempData},flipXY:function(data,w,h){return this.flipY(this.flipX(data,w,h),w,h)},threshold:function(data,threshold){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2],v=.2126*r+.7152*g+.0722*b>=threshold?255:0;data[i]=data[i+1]=data[i+2]=v}return data},brightness:function(data,w,h,amount){for(var y=0;h>y;y++)for(var x=0;w>x;x++){var pixel=4*(y*w+x),hsv=Buffer.rgbToHsv(data[pixel],data[pixel+1],data[pixel+2]);hsv[2]+=amount,hsv[2]<0?hsv[2]=0:hsv[2]>1&&(hsv[2]=1);for(var rgb=Buffer.hsvToRgb(hsv[0],hsv[1],hsv[2]),i=0;3>i;i++)data[pixel+i]=rgb[i]}return data},monochrome:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2],v=Math.floor((r+g+b)/3);data[i]=data[i+1]=data[i+2]=v>127?255:0,data[i+3]=255}return data},grayscale:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2],v=.2126*r+.7152*g+.0722*b;data[i]=data[i+1]=data[i+2]=v}return data},sepia:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2];data[i]=.393*r+.769*g+.189*b,data[i+1]=.349*r+.686*g+.168*b,data[i+2]=.272*r+.534*g+.131*b}return data},red:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2];data[i]=(r+g+b)/3,data[i+1]=data[i+2]=0}return data},green:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2];data[i+1]=(r+g+b)/3,data[i]=data[i+2]=0}return data},blue:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2];data[i+2]=(r+g+b)/3,data[i]=data[i+1]=0}return data},ditherC64_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.C64,algorithm:Dithering.ALGORITHM.REDUCE})},ditherC64_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.C64,algorithm:Dithering.ALGORITHM.ORDERED})},ditherC64_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.C64,algorithm:Dithering.ALGORITHM.ERROR})},ditherC64_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.C64,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherSPECTRUM_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.SPECTRUM,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherSPECTRUM_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.SPECTRUM,algorithm:Dithering.ALGORITHM.REDUCE})},ditherSPECTRUM_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.SPECTRUM,algorithm:Dithering.ALGORITHM.ORDERED})},ditherSPECTRUM_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.SPECTRUM,algorithm:Dithering.ALGORITHM.ERROR})},ditherAMIGA_BRONZE_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_BRONZE,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherAMIGA_BRONZE_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_BRONZE,algorithm:Dithering.ALGORITHM.REDUCE})},ditherAMIGA_BRONZE_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_BRONZE,algorithm:Dithering.ALGORITHM.ORDERED})},ditherAMIGA_BRONZE_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_BRONZE,algorithm:Dithering.ALGORITHM.ERROR})},ditherMONO_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.MONO,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherMONO_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.MONO,algorithm:Dithering.ALGORITHM.REDUCE})},ditherMONO_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.MONO,algorithm:Dithering.ALGORITHM.ORDERED})},ditherMONO_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.MONO,algorithm:Dithering.ALGORITHM.ERROR})},ditherAMIGA_ORANGE_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_ORANGE,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherAMIGA_ORANGE_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_ORANGE,algorithm:Dithering.ALGORITHM.REDUCE})},ditherAMIGA_ORANGE_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_ORANGE,algorithm:Dithering.ALGORITHM.ORDERED})},ditherAMIGA_ORANGE_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_ORANGE,algorithm:Dithering.ALGORITHM.ERROR})},ditherBASIC_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.BASIC,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherBASIC_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.BASIC,algorithm:Dithering.ALGORITHM.REDUCE})},ditherBASIC_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.BASIC,algorithm:Dithering.ALGORITHM.ORDERED})},ditherBASIC_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.BASIC,algorithm:Dithering.ALGORITHM.ERROR})}}}),define("lib/Mixin",["underscore"],function(_){"use strict";_.mixin({capitalize:function(str){return str.length&&(str=str.charAt(0).toUpperCase()+str.slice(1)),str},format:function(){for(var s=arguments[0],i=1;i<arguments.length;i++){var regEx=new RegExp("\\{"+(i-1)+"\\}","gm");s=s.replace(regEx,arguments[i])}return s},deepClone:function(data){return this.map(data,this.clone)}})}),define("lib/Options",["lib/Filter","lib/Dithering","lib/Triangle"],function(Filter,Dithering,Triangle){"use strict";return{options:{mirror:{name:"Отражение",type:"Select",options:[{text:"Нет"},{text:"По оси X",cb:Filter.flipX},{text:"По оси Y",cb:Filter.flipY},{text:"По оси X и Y",cb:Filter.flipXY}]},kaleidoscope:{name:"Калейдоскоп",type:"Select",options:[{text:"Нет"},{text:"К центру",cb:Filter.kaleidoskopeCenter},{text:"В стороны",cb:Filter.kaleidoskopeOutside},{text:"К центру и в стороны",cb:Filter.kaleidoskopeCenterOutside},{text:"По горизонтали",cb:Filter.kaleidoskopeHoriz},{text:"По вертикали",cb:Filter.kaleidoskopeVert},{text:"Игральная карта",cb:Filter.kaleidoskopeCard}]},colors:{name:"Цвет",type:"Select",options:[{text:"Нет"},{text:"Монохром",cb:Filter.monochrome},{text:"Градации серого",cb:Filter.grayscale},{text:"Сепия",cb:Filter.sepia},{text:"Красный",cb:Filter.red},{text:"Зеленый",cb:Filter.green},{text:"Синий",cb:Filter.blue}]},brightness:{name:"Яркость",type:"Slider",min:-1,max:1,def:0,step:.01},contrast:{name:"Контраст",type:"Slider",min:0,max:259,def:0},hue:{name:"Тон",type:"Slider",min:-1,max:1,def:0,step:.01},saturation:{name:"Насыщенность",type:"Slider",min:0,max:2,def:0,step:.01},threshold:{name:"Порог",
type:"Slider",min:0,max:200,def:0,cb:Filter.threshold},blur:{name:"Размытие",type:"Slider",min:0,max:10,def:0,step:.1},sharpen:{name:"Резкость",type:"Slider",min:0,max:10,def:0},edge:{name:"Поиск края",type:"Slider",min:0,max:2,def:0},bump:{name:"Выдавливание",type:"Slider",min:0,max:1,def:0},emboss:{name:"Рельеф",type:"Slider",min:0,max:10,def:0,step:.1},sobel:{name:"Оператор Собеля",type:"Slider",min:0,max:1,def:0},thin:{name:"Контур",type:"Slider",min:0,max:2,def:0},dither:{name:"Дизеринг",type:"Select",options:function(){var options=[{text:"Нет"}];return _.each(Dithering.PALETTE,function(obj,keyP){var nameP=obj.name;_.each(Dithering.ALGORITHM,function(nameA,keyA){options.push({text:_.format("{0} ({1})",nameP,nameA),cb:Filter[_.format("dither{0}_{1}",keyP,keyA)]})},this)},this),options}()},pattern:{name:"Паттерн",type:"Select",options:function(){var options=[{text:"Нет"}];return Object.keys(Triangle).forEach(function(k){options.push({text:_.capitalize(k),model:k})}),options}()},zhangSuen:{name:"Скелет",type:"Slider",min:0,max:1,def:0},invert:{name:"Инверсия",type:"Slider",min:0,max:1,def:0}}}}),define("lib/Preset",[],function(){"use strict";return{"Fun dithering":{pattern:5,kaleidoscope:4},Thin:{saturation:2,colors:2,brightness:.15,contrast:95,sharpen:2,zhangSuen:1}}}),define("lib/Processor",["backbone","underscore","lib/Filter","lib/Storage","lib/Triangle","lib/Options","lib/Mixin"],function(Backbone,_,Filter,Storage,Triangle,Options){"use strict";return{w:0,h:0,doit:function(imageData){return this.filter=Storage.getFilter(),this.options=Options.options,this.data=imageData.data,this.w=imageData.width,this.h=imageData.height,this.applyPost(),{data:this.data,w:this.w,h:this.h}},applyPost:function(){0!==Object.getOwnPropertyNames(this.filter).length&&_.each(Object.keys(this.filter),function(key){this["post"+_.capitalize(key)](this.filter[key])},this)},postMirror:function(filter){parseInt(filter)&&this.options.mirror.options[filter].cb&&this.options.mirror.options[filter]&&(this.data=this.options.mirror.options[filter].cb.call(Filter,this.data,this.w,this.h))},postInvert:function(filter){parseInt(filter)&&(this.data=Filter.invert(this.data))},postSaturation:function(filter){parseFloat(filter)&&(this.data=Filter.saturation(this.data,this.w,this.h,parseFloat(filter)))},postDither:function(filter){parseInt(filter)&&this.options.dither.options[filter].cb&&this.options.dither.options[filter]&&(this.data=this.options.dither.options[filter].cb.call(this,this.data,this.w,this.h))},postThin:function(filter){if(parseInt(filter))switch(parseInt(filter)){case 1:this.data=Filter.convolute(this.data,this.w,this.h,[1,1,1,1,-7,1,1,1,1]);break;default:this.data=Filter.emboss(this.data,this.w,this.h,5,180,90)}},postZhangSuen:function(filter){parseInt(filter)&&(this.data=Filter.zhangSuen(this.data,this.w,this.h))},postSobel:function(filter){parseInt(filter)&&(this.data=Filter.sobel(this.data,this.w))},postEmboss:function(filter){parseFloat(filter)&&(this.data=Filter.emboss(this.data,this.w,this.h,parseFloat(filter)))},postEdge:function(filter){if(parseInt(filter)){var edFac=parseInt(filter),edMtx=[];switch(edFac){case 1:edMtx=[1,1,1,1,-7,1,1,1,1];break;case 2:edMtx=[-5,0,0,0,0,0,0,0,5]}this.data=Filter.convolve3x3(this.data,this.w,edMtx)}},postSharpen:function(filter){if(parseInt(filter)){var sFac=parseInt(filter),sMtx=[];2>sFac?(sFac+=4,sMtx=[0,-1,0,-1,sFac,-1,0,-1,0]):(sFac+=7,sMtx=[-1,-1,-1,-1,sFac,-1,-1,-1,-1]),this.data=Filter.convolute(this.data,this.w,this.h,sMtx)}},postBump:function(filter){parseInt(filter)&&(this.data=Filter.convolve3x3(this.data,this.w,[-1,-1,0,-1,1,1,0,1,1]))},postPattern:function(filter){if(parseInt(filter)&&this.options.pattern.options[filter]&&this.options.pattern.options[filter].model){var model=Triangle[this.options.pattern.options[filter].model](),data=model.doit(this.data,this.w,this.h);this.data=data.data,this.w=data.w,this.h=data.h}},postBlur:function(filter){parseFloat(filter)&&(this.data=Filter.blur(this.data,this.w,this.h,parseFloat(filter)))},postThreshold:function(filter){parseInt(filter)&&this.options.threshold.cb&&(this.data=this.options.threshold.cb.call(this,this.data,parseInt(filter)))},postContrast:function(filter){parseInt(filter)&&Filter.contrast&&(this.data=Filter.contrast(this.data,parseInt(filter)))},postHue:function(filter){parseFloat(filter)&&Filter.hue&&(this.data=Filter.hue(this.data,this.w,this.h,parseFloat(filter)))},postBrightness:function(filter){parseFloat(filter)&&Filter.brightness&&(this.data=Filter.brightness(this.data,this.w,this.h,parseFloat(filter)))},postColors:function(filter){parseInt(filter)&&this.options.colors.options[filter]&&this.options.colors.options[filter].cb&&(this.data=this.options.colors.options[filter].cb.call(this,this.data))},postKaleidoscope:function(filter){parseInt(filter)&&this.options.kaleidoscope.options[filter]&&this.options.kaleidoscope.options[filter].cb&&(this.data=this.options.kaleidoscope.options[filter].cb.call(Filter,this.data,this.w,this.h))}}}),define("lib/Random",["lib/Canvas","fabric"],function(Canvas){"use strict";return{generate:function(w,h,count){count=count||100;var canvas=(Canvas.createEmptyCanvas(w,h,"random-canvas"),new fabric.Canvas("random-canvas"));canvas.setDimensions({width:w,height:h});var objects=Object.keys(this.objects),rect=new fabric.Rect({left:0,top:0,fill:"rgb("+[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())].join(",")+")",width:w,height:h});canvas.add(rect);for(var i=0;i<=Math.round(Math.random()*count);i++){var o=objects[Math.round(Math.random()*(objects.length-1))];this.objects[o](canvas,w,h)}return canvas.toDataURL()},objects:{poly:function(canvas,w,h){for(var points=[],i=0;i<=Math.round(100*Math.random());i++)points.push({x:Math.round(Math.random()*w),y:Math.round(Math.random()*h)});var rect=new fabric.Polygon(points,{fill:"rgb("+[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())].join(",")+")",left:Math.round(Math.random()*w),top:Math.round(Math.random()*h),angle:Math.round(360*Math.random()),opacity:Math.round(100*Math.random())/100});rect.setShadow({color:"rgba(0,0,0,0.3)",offsetX:Math.round(20*Math.random()),offsetY:Math.round(20*Math.random())}),canvas.add(rect)},rect:function(canvas,w,h){var rect=new fabric.Rect({left:Math.round(Math.random()*w),top:Math.round(Math.random()*h),fill:"rgb("+[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())].join(",")+")",width:Math.round(Math.random()*w),height:Math.round(Math.random()*h),angle:Math.round(360*Math.random()),opacity:Math.round(100*Math.random())/100});rect.setShadow({color:"rgba(0,0,0,0.3)",offsetX:Math.round(20*Math.random()),offsetY:Math.round(20*Math.random())}),canvas.add(rect)},ellipse:function(canvas,w,h){var rect=new fabric.Ellipse({left:Math.round(Math.random()*w),top:Math.round(Math.random()*h),fill:"rgb("+[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())].join(",")+")",rx:Math.round(Math.random()*w),ry:Math.round(Math.random()*h),opacity:Math.round(100*Math.random())/100});rect.setShadow({color:"rgba(0,0,0,0.3)",offsetX:Math.round(20*Math.random()),offsetY:Math.round(20*Math.random())}),canvas.add(rect)},triangle:function(canvas,w,h){var rect=new fabric.Triangle({left:Math.round(Math.random()*w),top:Math.round(Math.random()*h),fill:"rgb("+[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())].join(",")+")",width:Math.round(Math.random()*w),height:Math.round(Math.random()*h),angle:Math.round(360*Math.random()),opacity:Math.round(100*Math.random())/100});rect.setShadow({color:"rgba(0,0,0,0.3)",offsetX:Math.round(20*Math.random()),offsetY:Math.round(20*Math.random())}),canvas.add(rect)},circle:function(canvas,w,h){var rect=new fabric.Circle({left:Math.round(Math.random()*w),top:Math.round(Math.random()*h),fill:"rgb("+[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())].join(",")+")",radius:Math.round(Math.random()*w/2),opacity:Math.round(100*Math.random())/100});rect.setShadow({color:"rgba(0,0,0,0.3)",offsetX:Math.round(20*Math.random()),offsetY:Math.round(20*Math.random())}),canvas.add(rect)}}}}),define("lib/Storage",[],function(){"use strict";return{getFilter:function(){return localStorage.filter?JSON.parse(localStorage.filter):{}},setFilter:function(filter){localStorage.filter=JSON.stringify(filter||{})},unsetFilter:function(){delete localStorage.filter},getEncoded:function(){return localStorage.encoded?JSON.parse(localStorage.encoded):null},setEncoded:function(data){localStorage.encoded=JSON.stringify(data)}}}),define("lib/Triangle",["models/TriangleCross","models/TrianglePeecol","models/TriangleBlocks","models/TriangleCrossRadial","models/TriangleDithering","models/TriangleKuwahara","models/TriangleLine","models/TriangleMeander","models/TriangleRealCross","models/TriangleSkull","models/TriangleStone","models/TriangleStoneAdvanced"],function(TriangleCross,TrianglePeecol,TriangleBlocks,TriangleCrossRadial,TriangleDithering,TriangleKuwahara,TriangleLine,TriangleMeander,TriangleRealCross,TriangleSkull,TriangleStone,TriangleStoneAdvanced){"use strict";return{Cross:function(){return new TriangleCross},"Cross Radial":function(){return new TriangleCrossRadial},Peecol:function(){return new TrianglePeecol},Blocks:function(){return new TriangleBlocks},Dithering:function(){return new TriangleDithering},Kuwahara:function(){return new TriangleKuwahara},Line:function(){return new TriangleLine},Meander:function(){return new TriangleMeander},"Real Cross":function(){return new TriangleRealCross},Skull:function(){return new TriangleSkull},Stone:function(){return new TriangleStone},"Stone Advanced":function(){return new TriangleStoneAdvanced}}}),define("models/AbstractTemplate",["backbone","underscore","lib/Buffer"],function(Backbone,_,Buffer){"use strict";return Backbone.Model.extend({TILE_WIDTH:0,TILE_HEIGHT:0,w:0,h:0,pattern:[],getColors:function(data,x,y){return[]},doit:function(data,w,h){return this.w=w,this.h=h,{data:data,w:this.w,h:this.h}},crop:function(data,x,y,w,h){return data=Buffer.grab(data,this.w,this.h,x,y,w,h),this.w=w,this.h=h,data},getPixelXY:function(data,x,y){return Buffer.getPixelXY(data,x,y,this.w)},setPixelXY:function(data,x,y,color){Buffer.setPixelXY(data,x,y,color,this.w)}})}),define("models/TriangleBlocks",["models/TriangleCross","lib/Buffer"],function(TriangleCrossModel,Buffer){"use strict";return TriangleCrossModel.extend({TILE_WIDTH:5,TILE_HEIGHT:5,getColors:function(data,x,y){var f,colors=[];return colors[5]=this.getPixelXY(data,x+Math.floor((this.TILE_WIDTH-1)/2),y+Math.floor((this.TILE_HEIGHT-1)/2)),f=.75,colors[2]=Buffer.mixColors(colors[5],Buffer.COLORS.BLACK,f),colors[3]=Buffer.mixColors(colors[5],Buffer.COLORS.WHITE,f),f=.125,colors[4]=Buffer.mixColors(colors[5],Buffer.COLORS.WHITE,f),colors[6]=Buffer.mixColors(colors[5],Buffer.COLORS.BLACK,f),f=.25,colors[7]=Buffer.mixColors(colors[5],Buffer.COLORS.BLACK,f),colors},pattern:[[5,2,2,2,2],[2,3,4,4,5],[2,4,5,5,6],[2,4,5,5,6],[2,5,6,6,7]]})}),define("models/TriangleCross",["backbone","underscore","models/AbstractTemplate"],function(Backbone,_,AbstractTemplate){"use strict";return AbstractTemplate.extend({pattern:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[4,4,1,1,1,1,1,1,1,1,1,1,1,1,2,2],[4,4,4,1,1,1,1,1,1,1,1,1,1,2,2,2],[4,4,4,4,1,1,1,1,1,1,1,1,2,2,2,2],[4,4,4,4,4,1,1,1,1,1,1,2,2,2,2,2],[4,4,4,4,4,4,1,1,1,1,2,2,2,2,2,2],[4,4,4,4,4,4,4,1,1,2,2,2,2,2,2,2],[4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2],[4,4,4,4,4,4,4,3,3,2,2,2,2,2,2,2],[4,4,4,4,4,4,3,3,3,3,2,2,2,2,2,2],[4,4,4,4,4,3,3,3,3,3,3,2,2,2,2,2],[4,4,4,4,3,3,3,3,3,3,3,3,2,2,2,2],[4,4,4,3,3,3,3,3,3,3,3,3,3,2,2,2],[4,4,3,3,3,3,3,3,3,3,3,3,3,3,2,2],[4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2]],TILE_WIDTH:16,TILE_HEIGHT:16,getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT/4),colors[2]=this.getPixelXY(data,x+this.TILE_WIDTH-this.TILE_WIDTH/4,y+this.TILE_HEIGHT/2),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT-this.TILE_HEIGHT/4),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/4,y+this.TILE_HEIGHT/2),colors},doit:function(data,w,h){this.w=w,this.h=h;var tilesW=Math.floor(this.w/this.TILE_WIDTH),tilesH=Math.floor(this.h/this.TILE_HEIGHT),newW=tilesW*this.TILE_WIDTH,newH=tilesH*this.TILE_HEIGHT;data=this.crop(data,0,0,newW,newH);var colors,x,y,px,py,out=new Uint8ClampedArray(data.length),pattern=_.isFunction(this.pattern)?this.pattern():this.pattern;for(x=0;newW>x;x+=this.TILE_WIDTH)for(y=0;newH>y;y+=this.TILE_HEIGHT)for(colors=this.getColors(data,x,y),px=0;px<this.TILE_WIDTH;px++)for(py=0;py<this.TILE_WIDTH;py++)pattern[py][px]&&this.setPixelXY(out,x+px,y+py,colors[pattern[py][px]]);return{data:out,w:this.w,h:this.h}}})}),define("models/TriangleCrossRadial",["models/TriangleCross"],function(TriangleCrossModel){"use strict";return TriangleCrossModel.extend({getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x+2,y+2),colors[3]=this.getPixelXY(data,x+4,y+4),colors[4]=this.getPixelXY(data,x+6,y+6),colors},pattern:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1],[1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1],[1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1],[1,1,2,2,3,3,4,4,4,4,3,3,2,2,1,1],[1,1,2,2,3,3,4,4,4,4,3,3,2,2,1,1],[1,1,2,2,3,3,4,4,4,4,3,3,2,2,1,1],[1,1,2,2,3,3,4,4,4,4,3,3,2,2,1,1],[1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1],[1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]})}),define("models/TriangleDithering",["models/TriangleCross"],function(TriangleCrossModel){"use strict";return TriangleCrossModel.extend({getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x,y+4),colors[3]=this.getPixelXY(data,x,y+8),colors[4]=this.getPixelXY(data,x,y+12),colors},pattern:[[1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1],[1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2],[1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1],[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],[2,1,2,2,2,1,2,2,2,1,2,2,2,1,2,2],[2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,1],[2,1,2,2,2,1,2,2,2,1,2,2,2,1,2,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,1]]})}),define("models/TriangleKuwahara",["models/TriangleCross","lib/Buffer"],function(TriangleCrossModel,Buffer){"use strict";return TriangleCrossModel.extend({TILE_WIDTH:5,TILE_HEIGHT:5,getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x+4,y),colors[3]=this.getPixelXY(data,x,y+4),colors[4]=this.getPixelXY(data,x+4,y+4),colors[5]=Buffer.mixColors(colors[1],colors[2]),colors[6]=Buffer.mixColors(colors[1],colors[3]),colors[7]=Buffer.mixColors(colors[2],colors[4]),colors[8]=Buffer.mixColors(colors[3],colors[4]),colors[9]=Buffer.mixColors(colors[5],colors[8]),colors[10]=Buffer.mixColors(colors[6],colors[5]),colors[11]=Buffer.mixColors(colors[5],colors[7]),colors[12]=Buffer.mixColors(colors[6],colors[8]),colors[13]=Buffer.mixColors(colors[7],colors[8]),colors},pattern:[[1,1,5,2,2],[1,10,5,11,2],[6,6,9,7,7],[3,12,8,13,4],[3,3,8,4,4]]})}),define("models/TriangleLine",["models/TriangleCross"],function(TriangleCrossModel){"use strict";return TriangleCrossModel.extend({getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x,y+4),colors[3]=this.getPixelXY(data,x,y+8),colors[4]=this.getPixelXY(data,x,y+12),colors},pattern:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]]})}),define("models/TriangleMeander",["models/TriangleCross"],function(TriangleCrossModel){"use strict";return TriangleCrossModel.extend({getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x,y+8),colors},pattern:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,1,1,1,1,1,1,1,1,2,2,2,1],[1,2,2,2,1,2,2,2,2,2,2,1,2,2,2,1],[1,2,2,2,1,2,2,2,2,2,2,1,2,2,2,1],[1,2,2,2,1,1,1,1,2,2,2,1,2,2,2,1],[1,2,2,2,2,2,2,1,2,2,2,1,2,2,2,1],[1,2,2,2,2,2,2,1,2,2,2,1,2,2,2,1],[1,2,2,2,2,2,2,1,2,2,2,1,2,2,2,1],[1,1,1,1,1,1,1,1,2,2,2,1,2,2,2,1],[2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1],[2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1],[2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,1]]})}),define("models/TrianglePeecol",["backbone","underscore","models/TriangleCross","lib/Buffer"],function(Backbone,_,TriangleCrossModel,Buffer){"use strict";return TriangleCrossModel.extend({TILE_WIDTH:36,TILE_HEIGHT:36,getColors:function(data,x,y){var colors=[];colors[1]=Buffer.COLORS.BLACK,colors[2]=this.getPixelXY(data,x-1,y),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y),colors[4]=this.getPixelXY(data,x-1,y+this.TILE_HEIGHT-1),colors[5]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1),colors[6]=this.getPixelXY(data,x-1,y+4),colors[7]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+4),colors[8]=this.getPixelXY(data,x-1,y+this.TILE_HEIGHT-1-4),colors[9]=this.getPixelXY(data,x,y+Math.floor((this.TILE_HEIGHT-1)/2)),colors[10]=this.getPixelXY(data,x-1,y+12),colors[11]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+12),colors[12]=this.getPixelXY(data,x-1,y+this.TILE_HEIGHT-1-12),colors[13]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1-12),colors[14]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1-4),colors[15]=this.getPixelXY(data,x+7,y+7),colors[16]=this.getPixelXY(data,x+this.TILE_WIDTH-1-7,y+7),colors[17]=this.getPixelXY(data,x+7,y+this.TILE_HEIGHT-1-7),colors[18]=this.getPixelXY(data,x+this.TILE_WIDTH-1-7,y+this.TILE_HEIGHT-1-7);var f=.25;return colors[19]=Buffer.mixColors(colors[6],Buffer.COLORS.BLACK,f),colors[20]=Buffer.mixColors(colors[8],Buffer.COLORS.BLACK,f),colors[21]=Buffer.mixColors(colors[7],Buffer.COLORS.BLACK,f),colors[22]=Buffer.mixColors(colors[14],Buffer.COLORS.BLACK,f),colors[23]=Buffer.mixColors(colors[9],Buffer.COLORS.BLACK,f),colors[24]=colors[9],colors[25]=this.getPixelXY(data,x+Math.floor((this.TILE_WIDTH-1)/2),y+Math.floor((this.TILE_HEIGHT-1)/2)),colors[26]=Buffer.mixColors(colors[9],Buffer.COLORS.WHITE,f),colors[27]=Buffer.mixColors(colors[6],Buffer.COLORS.WHITE,f),colors[28]=Buffer.mixColors(colors[8],Buffer.COLORS.WHITE,f),colors[29]=Buffer.mixColors(colors[7],Buffer.COLORS.WHITE,f),colors[30]=Buffer.mixColors(colors[14],Buffer.COLORS.WHITE,f),colors},pattern:[[2,1,19,27,6,1,2,2,2,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,3,3,3,1,7,29,21,1,3],[1,1,19,27,6,1,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,1,7,29,21,1,1],[19,19,19,27,6,1,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,1,7,29,21,21,21],[27,27,27,27,6,1,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,1,7,29,29,29,29],[6,6,6,6,6,1,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,1,7,7,7,7,7],[1,1,1,1,1,15,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,16,1,1,1,1,1],[2,15,15,15,15,15,15,15,1,10,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,11,1,16,16,16,16,16,16,16,3],[2,15,15,15,15,15,15,1,10,10,10,10,10,10,1,23,9,9,9,9,23,1,11,11,11,11,11,11,1,16,16,16,16,16,16,3],[2,15,15,15,15,15,1,10,10,10,10,10,10,1,23,9,9,9,9,9,9,23,1,11,11,11,11,11,11,1,16,16,16,16,16,3],[1,1,1,1,1,1,10,10,10,10,10,10,1,23,9,9,9,9,9,9,9,9,23,1,11,11,11,11,11,11,1,1,1,1,1,1],[10,10,10,10,10,10,10,10,10,10,10,1,23,9,9,9,9,9,9,9,9,9,9,23,1,11,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,10,1,23,9,9,9,9,9,9,9,9,9,9,9,9,23,1,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,1,23,9,9,9,9,9,9,9,9,9,9,9,9,9,9,23,1,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,1,23,9,9,9,9,23,23,23,23,23,23,23,23,9,9,9,9,23,1,11,11,11,11,11,11,11,11],[1,1,1,1,1,1,1,1,23,9,9,9,9,23,26,26,26,26,26,26,26,26,23,9,9,9,9,23,1,1,1,1,1,1,1,1],[24,24,24,24,24,24,24,23,9,9,9,9,9,23,26,23,23,23,23,23,23,26,23,9,9,9,9,9,23,24,24,24,24,24,24,24],[26,26,26,26,26,26,26,9,9,9,9,9,9,23,26,23,25,25,25,25,23,26,23,9,9,9,9,9,9,26,26,26,26,26,26,26],[26,26,26,26,26,26,26,9,9,9,9,9,9,23,26,23,25,25,25,25,23,26,23,9,9,9,9,9,9,26,26,26,26,26,26,26],[26,26,26,26,26,26,26,9,9,9,9,9,9,23,26,23,25,25,25,25,23,26,23,9,9,9,9,9,9,26,26,26,26,26,26,26],[26,26,26,26,26,26,26,9,9,9,9,9,9,23,26,23,25,25,25,25,23,26,23,9,9,9,9,9,9,26,26,26,26,26,26,26],[24,24,24,24,24,24,24,23,9,9,9,9,9,23,26,23,23,23,23,23,23,26,23,9,9,9,9,9,23,24,24,24,24,24,24,24],[1,1,1,1,1,1,1,1,23,9,9,9,9,23,26,26,26,26,26,26,26,26,23,9,9,9,9,23,1,1,1,1,1,1,1,1],[12,12,12,12,12,12,12,12,1,23,9,9,9,9,23,23,23,23,23,23,23,23,9,9,9,9,23,1,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,1,23,9,9,9,9,9,9,9,9,9,9,9,9,9,9,23,1,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,1,23,9,9,9,9,9,9,9,9,9,9,9,9,23,1,13,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,12,1,23,9,9,9,9,9,9,9,9,9,9,23,1,13,13,13,13,13,13,13,13,13,13,13],[1,1,1,1,1,1,12,12,12,12,12,12,1,23,9,9,9,9,9,9,9,9,23,1,13,13,13,13,13,13,1,1,1,1,1,1],[4,17,17,17,17,17,1,12,12,12,12,12,12,1,23,9,9,9,9,9,9,23,1,13,13,13,13,13,13,1,18,18,18,18,18,5],[4,17,17,17,17,17,17,1,12,12,12,12,12,12,1,23,9,9,9,9,23,1,13,13,13,13,13,13,1,18,18,18,18,18,18,5],[4,17,17,17,17,17,17,17,1,12,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,13,1,18,18,18,18,18,18,18,5],[1,1,1,1,1,17,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,18,1,1,1,1,1],[8,8,8,8,8,1,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,1,14,14,14,14,14],[28,28,28,28,8,1,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,1,14,30,30,30,30],[20,20,20,28,8,1,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,1,14,30,22,22,22],[1,1,20,28,8,1,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,1,14,30,22,1,1],[4,1,20,28,8,1,4,4,4,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,5,5,5,1,14,30,22,1,5]]})}),define("models/TriangleRealCross",["models/TriangleCross"],function(TriangleCrossModel){"use strict";return TriangleCrossModel.extend({getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x+2,y+2),colors[3]=this.getPixelXY(data,x+4,y+4),colors[4]=this.getPixelXY(data,x+6,y+6),colors},pattern:[[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[2,2,2,2,2,3,3,4,4,3,3,2,2,2,2,2],[2,2,2,2,2,3,3,4,4,3,3,2,2,2,2,2],[3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3],[2,2,2,2,2,3,3,4,4,3,3,2,2,2,2,2],[2,2,2,2,2,3,3,4,4,3,3,2,2,2,2,2],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1]]})}),define("models/TriangleSkull",["models/TriangleCross"],function(TriangleCrossModel){"use strict";return TriangleCrossModel.extend({getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+4),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT/2),colors[5]=this.getPixelXY(data,x,y+this.TILE_HEIGHT-1),colors[6]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1),colors},pattern:[[1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3],[1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3],[1,1,2,2,2,2,4,4,4,4,2,2,2,2,3,3],[2,2,2,2,2,4,4,4,4,4,4,2,2,2,2,2],[2,2,2,2,4,4,4,4,4,4,4,4,2,2,2,2],[2,2,2,2,4,4,2,4,4,2,4,4,2,2,2,2],[2,2,2,2,4,4,2,4,4,2,4,4,2,2,2,2],[2,2,2,2,4,4,4,4,4,4,4,4,2,2,2,2],[2,2,2,2,4,4,4,4,4,4,4,4,2,2,2,2],[2,2,2,2,2,2,4,4,4,4,2,2,2,2,2,2],[5,5,2,2,2,2,4,4,4,4,2,2,2,2,6,6],[5,5,5,2,2,2,2,2,2,2,2,2,2,6,6,6],[5,5,5,5,2,2,2,2,2,2,2,2,6,6,6,6],[5,2,5,5,2,2,2,2,2,2,2,2,6,6,2,6],[5,2,5,5,2,2,2,2,2,2,2,2,6,6,2,6]]})}),define("models/TriangleStone",["models/TriangleCross"],function(TriangleCrossModel){"use strict";return TriangleCrossModel.extend({getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x+1,y+1),colors[2]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1),colors},pattern:[[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,2,2,1,2,2,2,1,2,2,2,2,2,1,2],[1,1,1,2,1,2,1,2,1,2,1,1,1,2,1,2],[2,2,2,2,1,2,2,2,1,2,2,2,2,2,1,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2]]})}),define("models/TriangleStoneAdvanced",["models/TriangleCross"],function(TriangleCrossModel){"use strict";return TriangleCrossModel.extend({getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT/2),colors[2]=this.getPixelXY(data,x,y),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH/4,y),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/4*3,y),colors[5]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y),colors[6]=this.getPixelXY(data,x,y+this.TILE_HEIGHT/4),colors[7]=this.getPixelXY(data,x+this.TILE_WIDTH/2-1,y+this.TILE_HEIGHT/2-1),colors[8]=this.getPixelXY(data,x+this.TILE_WIDTH/4*3,y+this.TILE_HEIGHT/2-1),colors[9]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT/2-1),colors[10]=this.getPixelXY(data,x,y+this.TILE_HEIGHT/4*3),colors[11]=this.getPixelXY(data,x+this.TILE_HEIGHT/4,y+this.TILE_HEIGHT/4*3),colors[12]=this.getPixelXY(data,x+this.TILE_HEIGHT/2,y+this.TILE_HEIGHT/4*3),colors[13]=this.getPixelXY(data,x+this.TILE_HEIGHT/4*3,y+this.TILE_HEIGHT/4*3),colors[14]=this.getPixelXY(data,x,y+this.TILE_HEIGHT-1),colors[15]=this.getPixelXY(data,x+this.TILE_WIDTH/4,y+this.TILE_HEIGHT-1),colors[16]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT-1),colors[17]=this.getPixelXY(data,x+this.TILE_WIDTH/4*3,y+this.TILE_HEIGHT-1),colors},pattern:[[1,1,2,1,3,1,1,1,3,1,4,1,4,1,5,1],[1,1,2,1,3,1,1,1,3,1,4,1,4,1,5,1],[1,1,2,1,3,1,1,1,3,1,4,1,4,1,5,1],[2,2,2,1,3,3,3,3,3,1,4,4,4,1,5,5],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[6,6,6,6,1,7,7,7,1,8,8,8,8,8,1,9],[1,1,1,6,1,7,1,7,1,8,1,1,1,8,1,9],[6,6,6,6,1,7,7,7,1,8,8,8,8,8,1,9],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[10,10,10,1,11,11,11,11,11,1,12,12,12,1,13,13],[1,1,10,1,11,1,1,1,11,1,12,1,12,1,13,1],[1,1,10,1,11,1,1,1,11,1,12,1,12,1,13,1],[1,1,10,1,11,1,1,1,11,1,12,1,12,1,13,1],[10,10,10,1,11,11,11,11,11,1,12,12,12,1,13,13],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[14,14,14,1,15,15,15,15,15,1,16,16,16,1,17,17]]})}),define("views/Wizard",["backbone","jquery","underscore","templates","lib/Canvas","lib/Processor","lib/Storage","lib/Random","lib/Options","lib/Preset","sortable","fabric"],function(Backbone,$,_,templates,Canvas,Processor,Storage,Random,Options,Preset,Sortable){"use strict";return Backbone.View.extend({el:"#wizard",encoded:null,imageName:null,elements:[],filterId:null,initialize:function(){this.elements.preloader=this.$(".preloader"),this.elements.error=this.$(".error400"),this.elements.srcImage=this.$(".src-image"),this.elements.dstImage=this.$(".dst-image"),this.elements.inputPreset=this.$("#input-preset"),this.elements.optionsModal=this.$("#options-modal"),this.elements.optionsForm=this.$("#options-form"),this.elements.messageModal=this.$("#message"),this.elements.save=this.$("#output-save"),Object.keys(Preset).forEach(function(key){this.elements.inputPreset.append($("<option/>",{value:key,text:key}))},this);var encoded=Storage.getEncoded();encoded&&(this.encoded=encoded,this.elements.srcImage.attr("src",encoded),this.render())},events:{"click #input-random":"onRandomButtonClick","click #input-url":"onUrlTextClick","click #input-url-button":"onDownloadButtonClick","click #show-options":"onShowOptionsButtonClick","click #options-apply":"onOptionsApplyClick","change #input-file":"onFileChange","change #input-preset":"onPresetChange"},onRandomButtonClick:function(e){e.preventDefault();var data=Random.generate(505,505,100);this.elements.srcImage.attr("src",data),this.encoded=data,Storage.setEncoded(this.encoded),this.render()},onOptionsApplyClick:function(e){e.preventDefault();var options={};this.elements.optionsModal.find("[data-option]").each(function(){var $e=$(this);options[$e.data("option")]=$e.val()}),Storage.setFilter(options),this.elements.optionsModal.modal("hide"),this.render()},onPresetChange:function(e){this.presetId=$(e.currentTarget).val(),this.presetId&&Preset[this.presetId]?Storage.setFilter(Preset[this.presetId]):Storage.unsetFilter(),this.render()},onShowOptionsButtonClick:function(e){e.preventDefault();var form=this.buildOptions();this.elements.optionsForm.html(form),this.sortable=Sortable.create(this.elements.optionsForm.get(0),{sort:!0,group:"options",handle:".drag-handle",animation:150});var filter=Storage.getFilter();_.isEmpty(filter)||this.sortable.sort(Object.keys(filter)),this.elements.optionsModal.modal()},onDownloadButtonClick:function(e){e.preventDefault();var url=$.trim(this.$("#input-url").val());!url.length||url.length>8190||(this.showPreloader(),$.getJSON("/api.php",{url:url},function(data){0==parseInt(data.error)?(this.elements.srcImage.title=data.name,this.elements.srcImage.attr("src",data.data),this.imageName=data.name,this.encoded=data.data,Storage.setEncoded(this.encoded),this.render()):this.elements.error.show(),this.showPreloader(!1)}.bind(this)))},onUrlTextClick:function(e){$(e.currentTarget).select()},onFileChange:function(e){var selectedFile=e.target.files[0],reader=new FileReader;this.elements.srcImage.title=selectedFile.name,this.imageName=selectedFile.name,reader.onload=function(event){this.elements.srcImage.attr("src",event.target.result),this.encoded=event.target.result,this.setEncoded(this.encoded),this.render()}.bind(this),reader.readAsDataURL(selectedFile)},message:function(msg){this.elements.messageModal.find(".message-body p").text(msg),this.elements.messageModal.modal()},buildOptions:function(){var options=Options.options,storageData=Storage.getFilter(),html="";return _.each(options,function(o,id){html+=templates.options[o.type]({option:o,id:id,value:storageData[id]||null})},this),html},showPreloader:function(state){state===!0||"undefined"==typeof state?this.elements.preloader.show():this.elements.preloader.fadeOut()},render:function(){if(this.encoded){this.showPreloader(),this.elements.error.hide();var srcImage=this.elements.srcImage[0],cvsIn=Canvas.createEmptyCanvas(srcImage.width,srcImage.height),ctxIn=cvsIn.getContext("2d");ctxIn.drawImage(srcImage,0,0,cvsIn.width,cvsIn.height);var idtIn=ctxIn.getImageData(0,0,cvsIn.width,cvsIn.height),result=Processor.doit(idtIn),cvsOut=Canvas.createEmptyCanvas(result.w,result.h),ctxOut=cvsOut.getContext("2d"),idtOut=ctxOut.createImageData(result.w,result.h);idtOut.data.set(result.data),ctxOut.putImageData(idtOut,0,0),
this.outData=cvsOut.toDataURL("image/png"),this.elements.dstImage.attr("src",this.outData);var d=new Date,name="pixla_"+d.getDate()+"-"+(d.getMonth()+1)+"-"+d.getFullYear()+"_"+d.getHours()+"-"+d.getMinutes()+"-"+d.getSeconds()+".png";this.elements.save.attr("href",this.outData),this.elements.save.attr("download",name),this.showPreloader(!1)}}})}),define("templates",function(require){"use strict";return{OptionsTitle:require("tpl!templates/OptionsTitle.ejs"),options:{Select:require("tpl!templates/options/Select.ejs"),Slider:require("tpl!templates/options/Slider.ejs")}}}),require.config({paths:{underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min",jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min",bootstrap:"//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min",share:"//yastatic.net/share/share",sortable:"//cdnjs.cloudflare.com/ajax/libs/Sortable/1.2.0/Sortable.min",fabric:"/vendor/fabric.min"},shim:{underscore:{exports:"_"},backbone:{exports:"Backbone",deps:["jquery","underscore"]},bootstrap:{deps:["jquery"]}},waitSeconds:60}),require(["jquery","views/Wizard","bootstrap","share","lib/Fileinput"],function($,WizardView){"use strict";$(function(){return $(document).on("click","a[href=#]",function(e){e.preventDefault()}),$("footer").css("background-color",$("body > nav").css("background-color")),$("footer *").css("color",$(".navbar-default .navbar-nav > li > a").css("color")),"undefined"!=typeof FileReader&&$.isFunction(FileReader)?($('[data-toggle="tooltip"]').tooltip(),$("#wizard").show(),$(":file").filestyle({buttonText:"",buttonName:"btn-primary",size:"sm"}),void new WizardView):void $("#old-browser").fadeIn("slow")})});