/**
 * Copyright (c) 2015 pointofpresence
 * ReSampled.Pixla (pixla) - Online image filter
 * @version v0.0.40
 * @build Mon Jul 06 2015 21:05:07
 * @link https://github.com/pointofpresence/pixla
 * @license MIT
 */
define("lib/Canvas",[],function(){"use strict";return{createEmptyCanvas:function(w,h){var canvas=document.createElement("canvas");return canvas.width=w,canvas.height=h,canvas},convertImageToCanvas:function(image){var canvas=this.createEmptyCanvas(image.width,image.height);return canvas.getContext("2d").drawImage(image,0,0),canvas},convertCanvasToImage:function(canvas,callback){var image=new Image;image.onload=function(){callback(image)},image.src=canvas.toDataURL("image/png")}}}),define("lib/Dithering",[],function(){"use strict";return{opt:{},ALGORITHM:{REDUCE:"Reduce",ORDERED:"Ordered",ERROR:"Error diffusion",ATKINSON:"Atkinson"},PALETTE:{C64:{name:"C64",data:[[0,0,0],[102,102,204],[102,204,204],[153,255,153],[204,102,102],[204,204,102],[255,255,255],[51,51,153],[102,51,0],[102,102,102],[102,153,51],[153,51,51],[153,51,153],[153,102,51],[153,153,153]]},BASIC:{name:"Basic",data:[[0,0,0],[255,0,255],[0,255,255],[255,255,255]]},SPECTRUM:{name:"ZX Spectrum",data:[[0,0,0],[0,0,255],[0,255,0],[0,255,255],[255,0,0],[255,0,255],[255,255,0],[255,255,255]]},MONO:{name:"Monochrome",data:[[0,0,0],[255,255,255]]},AMIGA_ORANGE:{name:"Amiga Orange",data:[[0,0,0],[0,0,51],[0,51,51],[102,102,204],[102,153,255],[204,102,51],[204,153,51],[204,153,153],[204,204,204],[255,153,102],[255,204,102],[255,204,153],[255,204,204],[51,0,0],[51,51,0],[51,51,51],[51,51,102],[51,51,153],[51,102,102],[51,102,153],[102,0,0],[102,51,0],[102,51,51],[102,102,51],[102,102,102],[153,51,0],[153,102,51],[153,153,153]]},AMIGA_BRONZE:{name:"Amiga Bronze",data:[[0,0,0],[204,102,51],[204,153,51],[204,153,102],[204,153,153],[204,204,153],[204,204,204],[255,153,102],[255,204,153],[255,204,204],[255,255,255],[51,0,0],[51,51,0],[51,51,51],[102,51,0],[102,51,51],[102,102,51],[102,102,102],[153,51,0],[153,102,51],[153,102,102],[153,153,102],[153,153,153]]}},dither:function(data,w,h,opt){switch(opt=opt||{},this.opt.step=opt.step||1,this.opt.algorithm=opt.algorithm||this.ALGORITHM.REDUCE,this.opt.palette=opt.palette.data||this.PALETTE.BASIC.data,this.w=w,this.h=h,this.opt.algorithm){case this.ALGORITHM.ERROR:return this.errorDiffusionDither(data);case this.ALGORITHM.ORDERED:return this.orderedDither(data);case this.ALGORITHM.ATKINSON:return this.atkinsonDither(data);case this.ALGORITHM.REDUCE:return this.reduceDither(data);default:throw new Error("Not a valid algorithm")}},colorDistance:function(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))},approximateColor:function(color){var palette=this.opt.palette,findIndex=function(fun,arg,list,min){if(2==list.length)return fun(arg,min)<=fun(arg,list[1])?min:list[1];var tl=list.slice(1);return min=fun(arg,min)<=fun(arg,list[1])?min:list[1],findIndex(fun,arg,tl,min)};return findIndex(this.colorDistance,color,palette,palette[0])},threshold:function(value){return 127>value?0:255},orderedDither:function(data){for(var d=new Uint8ClampedArray(data),w=this.w,h=this.h,step=this.opt.step,ratio=3,m=[[1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]],y=0;h>y;y+=step)for(var x=0;w>x;x+=step){var i=4*x+4*y*w,r=i,g=i+1,b=i+2;d[r]+=m[x%4][y%4]*ratio,d[g]+=m[x%4][y%4]*ratio,d[b]+=m[x%4][y%4]*ratio;for(var color=[d[r],d[g],d[b]],approx=this.approximateColor(color),tr=approx[0],tg=approx[1],tb=approx[2],dx=0;step>dx;dx++)for(var dy=0;step>dy;dy++){var di=i+4*dx+4*w*dy;d[di]=tr,d[di+1]=tg,d[di+2]=tb}}return d},reduceDither:function(data){for(var d=new Uint8ClampedArray(data),w=this.w,h=this.h,step=this.opt.step,y=0;h>y;y+=step)for(var x=0;w>x;x+=step)for(var i=4*x+4*y*w,r=i,g=i+1,b=i+2,color=[d[r],d[g],d[b]],approx=this.approximateColor(color),tr=approx[0],tg=approx[1],tb=approx[2],dx=0;step>dx;dx++)for(var dy=0;step>dy;dy++){var di=i+4*dx+4*w*dy;d[di]=tr,d[di+1]=tg,d[di+2]=tb}return d},atkinsonDither:function(data){for(var d=new Uint8ClampedArray(data),out=new Uint8ClampedArray(data),w=this.w,h=this.h,step=this.opt.step,ratio=1/8,y=0;h>y;y+=step)for(var x=0;w>x;x+=step){var i=4*x+4*y*w,$i=function(x,y){return 4*x+4*y*w},r=i,g=i+1,b=i+2,color=[d[r],d[g],d[b]],approx=this.approximateColor(color),q=[];q[r]=d[r]-approx[0],q[g]=d[g]-approx[1],q[b]=d[b]-approx[2],d[$i(x+step,y)+0]+=ratio*q[r],d[$i(x-step,y+step)+0]+=ratio*q[r],d[$i(x,y+step)+0]+=ratio*q[r],d[$i(x+step,y+step)+0]+=ratio*q[r],d[$i(x+2*step,y)+0]+=ratio*q[r],d[$i(x,y+2*step)+0]+=ratio*q[r],d[$i(x+step,y)+1]+=ratio*q[r],d[$i(x-step,y+step)+1]+=ratio*q[r],d[$i(x,y+step)+1]+=ratio*q[r],d[$i(x+step,y+step)+1]+=ratio*q[r],d[$i(x+2*step,y)+1]+=ratio*q[r],d[$i(x,y+2*step)+1]+=ratio*q[r],d[$i(x+step,y)+2]+=ratio*q[r],d[$i(x-step,y+step)+2]+=ratio*q[r],d[$i(x,y+step)+2]+=ratio*q[r],d[$i(x+step,y+step)+2]+=ratio*q[r],d[$i(x+2*step,y)+2]+=ratio*q[r],d[$i(x,y+2*step)+2]+=ratio*q[r];for(var tr=approx[0],tg=approx[1],tb=approx[2],dx=0;step>dx;dx++)for(var dy=0;step>dy;dy++){var di=i+4*dx+4*w*dy;out[di]=tr,out[di+1]=tg,out[di+2]=tb}}return out},errorDiffusionDither:function(data){for(var d=new Uint8ClampedArray(data),out=new Uint8ClampedArray(data),w=this.w,h=this.h,step=this.opt.step,ratio=1/16,y=0;h>y;y+=step)for(var x=0;w>x;x+=step){var i=4*x+4*y*w,$i=function(x,y){return 4*x+4*y*w},r=i,g=i+1,b=i+2,color=[d[r],d[g],d[b]],approx=this.approximateColor(color),q=[];q[r]=d[r]-approx[0],q[g]=d[g]-approx[1],q[b]=d[b]-approx[2],d[$i(x+step,y)]=d[$i(x+step,y)]+7*ratio*q[r],d[$i(x-step,y+1)]=d[$i(x-1,y+step)]+3*ratio*q[r],d[$i(x,y+step)]=d[$i(x,y+step)]+5*ratio*q[r],d[$i(x+step,y+step)]=d[$i(x+1,y+step)]+1*ratio*q[r],d[$i(x+step,y)+1]=d[$i(x+step,y)+1]+7*ratio*q[g],d[$i(x-step,y+step)+1]=d[$i(x-step,y+step)+1]+3*ratio*q[g],d[$i(x,y+step)+1]=d[$i(x,y+step)+1]+5*ratio*q[g],d[$i(x+step,y+step)+1]=d[$i(x+step,y+step)+1]+1*ratio*q[g],d[$i(x+step,y)+2]=d[$i(x+step,y)+2]+7*ratio*q[b],d[$i(x-step,y+step)+2]=d[$i(x-step,y+step)+2]+3*ratio*q[b],d[$i(x,y+step)+2]=d[$i(x,y+step)+2]+5*ratio*q[b],d[$i(x+step,y+step)+2]=d[$i(x+step,y+step)+2]+1*ratio*q[b];for(var tr=approx[0],tg=approx[1],tb=approx[2],dx=0;step>dx;dx++)for(var dy=0;step>dy;dy++){var di=i+4*dx+4*w*dy;out[di]=tr,out[di+1]=tg,out[di+2]=tb}}return out}}}),define("lib/Fileinput",["jquery"],function($){"use strict";var b=function(d,e){this.options=e,this.$elementFilestyle=[],this.$element=$(d)};b.prototype={clear:function(){this.$element.val(""),this.$elementFilestyle.find(":text").val(""),this.$elementFilestyle.find(".badge").remove()},destroy:function(){this.$element.removeAttr("style").removeData("filestyle").val(""),this.$elementFilestyle.remove()},disabled:function(d){if(d===!0)this.options.disabled||(this.$element.attr("disabled","true"),this.$elementFilestyle.find("label").attr("disabled","true"),this.options.disabled=!0);else{if(d!==!1)return this.options.disabled;this.options.disabled&&(this.$element.removeAttr("disabled"),this.$elementFilestyle.find("label").removeAttr("disabled"),this.options.disabled=!1)}},buttonBefore:function(d){if(d===!0)this.options.buttonBefore||(this.options.buttonBefore=!0,this.options.input&&(this.$elementFilestyle.remove(),this.constructor(),this.pushNameFiles()));else{if(d!==!1)return this.options.buttonBefore;this.options.buttonBefore&&(this.options.buttonBefore=!1,this.options.input&&(this.$elementFilestyle.remove(),this.constructor(),this.pushNameFiles()))}},icon:function(d){if(d===!0)this.options.icon||(this.options.icon=!0,this.$elementFilestyle.find("label").prepend(this.htmlIcon()));else{if(d!==!1)return this.options.icon;this.options.icon&&(this.options.icon=!1,this.$elementFilestyle.find(".glyphicon").remove())}},input:function(e){if(e===!0)this.options.input||(this.options.input=!0,this.options.buttonBefore?this.$elementFilestyle.append(this.htmlInput()):this.$elementFilestyle.prepend(this.htmlInput()),this.$elementFilestyle.find(".badge").remove(),this.pushNameFiles(),this.$elementFilestyle.find(".group-span-filestyle").addClass("input-group-btn"));else{if(e!==!1)return this.options.input;if(this.options.input){this.options.input=!1,this.$elementFilestyle.find(":text").remove();var d=this.pushNameFiles();d.length>0&&this.options.badge&&this.$elementFilestyle.find("label").append(' <span class="badge">'+d.length+"</span>"),this.$elementFilestyle.find(".group-span-filestyle").removeClass("input-group-btn")}}},size:function(d){if(void 0===d)return this.options.size;var f=this.$elementFilestyle.find("label"),e=this.$elementFilestyle.find("input");f.removeClass("btn-lg btn-sm"),e.removeClass("input-lg input-sm"),"nr"!=d&&(f.addClass("btn-"+d),e.addClass("input-"+d))},buttonText:function(d){return void 0===d?this.options.buttonText:(this.options.buttonText=d,void this.$elementFilestyle.find("label span").html(this.options.buttonText))},buttonName:function(d){return void 0===d?this.options.buttonName:(this.options.buttonName=d,void this.$elementFilestyle.find("label").attr({"class":"btn "+this.options.buttonName}))},iconName:function(d){return void 0===d?this.options.iconName:void this.$elementFilestyle.find(".glyphicon").attr({"class":".glyphicon "+this.options.iconName})},htmlIcon:function(){return this.options.icon?'<span class="glyphicon '+this.options.iconName+'"></span> ':""},htmlInput:function(){return this.options.input?'<input type="text" class="form-control '+("nr"==this.options.size?"":"input-"+this.options.size)+'" disabled> ':""},pushNameFiles:function(){var d="",f=[];void 0===this.$element[0].files?f[0]={name:this.$element[0]&&this.$element[0].value}:f=this.$element[0].files;for(var e=0;e<f.length;e++)d+=f[e].name.split("\\").pop()+", ";return this.$elementFilestyle.find(":text").val(""!==d?d.replace(/\, $/g,""):""),f},constructor:function(){var h=this,f="",g=h.$element.attr("id"),i="";""!==g&&g||(g="filestyle-"+$(".bootstrap-filestyle").length,h.$element.attr({id:g})),i='<span class="group-span-filestyle '+(h.options.input?"input-group-btn":"")+'"><label for="'+g+'" class="btn '+h.options.buttonName+" "+("nr"==h.options.size?"":"btn-"+h.options.size)+'" '+(h.options.disabled?'disabled="true"':"")+">"+h.htmlIcon()+h.options.buttonText+"</label></span>",f=h.options.buttonBefore?i+h.htmlInput():h.htmlInput()+i,h.$elementFilestyle=$('<div class="bootstrap-filestyle input-group">'+f+"</div>"),h.$elementFilestyle.find(".group-span-filestyle").attr("tabindex","0").keypress(function(j){return 13===j.keyCode||32===j.charCode?(h.$elementFilestyle.find("label").click(),!1):void 0}),h.$element.css({position:"absolute",clip:"rect(0px 0px 0px 0px)"}).attr("tabindex","-1").after(h.$elementFilestyle),h.options.disabled&&h.$element.attr("disabled","true"),h.$element.change(function(){var j=h.pushNameFiles();0==h.options.input&&h.options.badge?0==h.$elementFilestyle.find(".badge").length?h.$elementFilestyle.find("label").append(' <span class="badge">'+j.length+"</span>"):0==j.length?h.$elementFilestyle.find(".badge").remove():h.$elementFilestyle.find(".badge").html(j.length):h.$elementFilestyle.find(".badge").remove()}),window.navigator.userAgent.search(/firefox/i)>-1&&h.$elementFilestyle.find("label").click(function(){return h.$element.click(),!1})}};var a=$.fn.filestyle;$.fn.filestyle=function(e,d){var f="",g=this.each(function(){if("file"===$(this).attr("type")){var j=$(this),h=j.data("filestyle"),i=$.extend({},$.fn.filestyle.defaults,e,"object"==typeof e&&e);h||(j.data("filestyle",h=new b(this,i)),h.constructor()),"string"==typeof e&&(f=h[e](d))}});return"undefined"!=typeof f?f:g},$.fn.filestyle.defaults={buttonText:"Choose file",iconName:"glyphicon-folder-open",buttonName:"btn-default",size:"nr",input:!0,badge:!0,icon:!0,buttonBefore:!1,disabled:!1},$.fn.filestyle.noConflict=function(){return $.fn.filestyle=a,this},$(function(){$(".filestyle").each(function(){var e=$(this),d={input:"false"!==e.attr("data-input"),icon:"false"!==e.attr("data-icon"),buttonBefore:"true"===e.attr("data-buttonBefore"),disabled:"true"===e.attr("data-disabled"),size:e.attr("data-size"),buttonText:e.attr("data-buttonText"),buttonName:e.attr("data-buttonName"),iconName:e.attr("data-iconName"),badge:"false"!==e.attr("data-badge")};e.filestyle(d)})})}),define("models/TriangleAbstract",["backbone","underscore","lib/Canvas","lib/Dithering"],function(Backbone,_,Canvas,Dithering){"use strict";return Backbone.Model.extend({defaults:{name:"Abstract Generator",description:"Abstract Model for Generators",sort:0},w:0,h:0,initialize:function(){this.options={mirror:{name:"Отражение",type:"Select",options:[{text:"Нет"},{text:"По оси X",cb:this.cbMirrorX},{text:"По оси Y",cb:this.cbMirrorY},{text:"По оси X и Y",cb:this.cbMirrorXY}]},kaleidoscope:{name:"Калейдоскоп",type:"Select",options:[{text:"Нет"},{text:"К центру",cb:this.centerKaleidoskope},{text:"В стороны",cb:this.outsideKaleidoskope},{text:"К центру и в стороны",cb:this.centerOutsideKaleidoskope},{text:"По горизонтали",cb:this.horizKaleidoskope},{text:"По вертикали",cb:this.vertKaleidoskope},{text:"Игральная карта",cb:this.cardKaleidoskope}]},colors:{name:"Цвет",type:"Select",options:[{text:"Нет"},{text:"Монохром",cb:this.monochrome},{text:"Градации серого",cb:this.grayscale},{text:"Сепия",cb:this.sepia},{text:"Красный",cb:this.red},{text:"Зеленый",cb:this.green},{text:"Синий",cb:this.blue}]},brightness:{name:"Яркость",type:"Slider",min:0,max:200,cb:this.brightness},threshold:{name:"Порог",type:"Slider",min:0,max:200,cb:this.threshold},blur:{name:"Размытие",type:"Slider",min:0,max:3},sharpen:{name:"Резкость",type:"Slider",min:0,max:10},edge:{name:"Поиск края",type:"Slider",min:0,max:2},emboss:{name:"Рельеф",type:"Slider",min:0,max:2},sobel:{name:"Оператор Собеля",type:"Slider",min:0,max:1},thin:{name:"Контур",type:"Slider",min:0,max:1},dither:{name:"Дизеринг",type:"Select",options:this.buildDitherList()},zhangSuen:{name:"Скелет",type:"Slider",min:0,max:1},invert:{name:"Инверсия",type:"Slider",min:0,max:1}}},COLORS:{BLACK:[0,0,0,255],WHITE:[255,255,255,255]},clone:function(data){return _.map(data,_.clone)},readOptions:function(){return localStorage[this.cid]?JSON.parse(localStorage[this.cid]):{}},setPixel:function(data,index,color){var i=4*index;data[i]=color[0],data[i+1]=color[1],data[i+2]=color[2],data[i+3]=color[3]},getPixel:function(data,index){var i=4*index;return[data[i],data[i+1],data[i+2],data[i+3]]},getPixelXY:function(data,x,y){return this.getPixel(data,Math.floor(y*this.w+x))},setPixelXY:function(data,x,y,color){return x>=this.w?void 0:this.setPixel(data,y*this.w+x,color)},componentToHex:function(c){var hex=c.toString(16);return 1==hex.length?"0"+hex:hex},rgbaToHex:function(color){return this.componentToHex(color[0])+this.componentToHex(color[1])+this.componentToHex(color[2])+this.componentToHex(color[3])},setShadeBlendPixel:function(data,x,y,percent,blendColor){var oc=this.getPixelXY(data,x,y),n=0>percent?-1*percent:percent;blendColor=blendColor?blendColor:0>percent?[0,0,0,oc[3]]:[255,255,255,oc[3]];var R=Math.round((blendColor[0]-oc[0])*n)+oc[0],G=Math.round((blendColor[1]-oc[1])*n)+oc[1],B=Math.round((blendColor[2]-oc[2])*n)+oc[2],A=Math.round((blendColor[3]-oc[3])*n)+oc[3];this.setPixelXY(data,x,y,[R,G,B,A])},zhangSuen:function(data,w,h){function Image2Bool(img,width,height){for(var s=[],y=0;height>y;y++){for(var sx=[],x=0;width>x;x++){var p=self.getPixelXY(img,x,y);if(0==x||0==y||x==width-1||y==height-1)sx.push(!1);else{var v=Math.floor((p[0]+p[1]+p[2])/3);sx.push(32>v)}}s.push(sx)}return s}function Bool2Image(s,width,height){for(var bmp=new Uint8ClampedArray(width*height*4),y=0;height>y;y++)for(var x=0;width>x;x++)s[y][x]?self.setPixelXY(bmp,x,y,[0,0,0,255]):self.setPixelXY(bmp,x,y,[255,255,255,255]);return bmp}function NumberOfNonZeroNeighbors(x,y,s){var count=0;return s[x-1][y]&&count++,s[x-1][y+1]&&count++,s[x-1][y-1]&&count++,s[x][y+1]&&count++,s[x][y-1]&&count++,s[x+1][y]&&count++,s[x+1][y+1]&&count++,s[x+1][y-1]&&count++,count}function NumberOfZeroToOneTransitionFromP9(x,y,s){var p2=s[x][y-1],p3=s[x+1][y-1],p4=s[x+1][y],p5=s[x+1][y+1],p6=s[x][y+1],p7=s[x-1][y+1],p8=s[x-1][y],p9=s[x-1][y-1];return+(!p2&&p3)+ +(!p3&&p4)+ +(!p4&&p5)+ +(!p5&&p6)+ +(!p6&&p7)+ +(!p7&&p8)+ +(!p8&&p9)+ +(!p9&&p2)}function SuenThinningAlg(x,y,s,even){var p2=s[x][y-1],p4=s[x+1][y],p6=s[x][y+1],p8=s[x-1][y],bp1=NumberOfNonZeroNeighbors(x,y,s);if(bp1>=2&&6>=bp1&&1==NumberOfZeroToOneTransitionFromP9(x,y,s))if(even){if(!(p2&&p4&&p8||p2&&p6&&p8))return!0}else if(!(p2&&p4&&p6||p4&&p6&&p8))return!0;return!1}function step(stepNo,temp,s){for(var count=0,a=1;a<temp.length-1;a++)for(var b=1;b<temp[0].length-1;b++)SuenThinningAlg(a,b,temp,2==stepNo)&&(s[a][b]&&count++,s[a][b]=!1);return count}function ZhangSuenThinning(img,width,height){var temp,s=Image2Bool(img,width,height),count=0;do temp=self.clone(s),count=step(1,temp,s),temp=self.clone(s),count+=step(2,temp,s);while(count>0);return Bool2Image(s,width,height)}var self=this;return ZhangSuenThinning(data,w,h)},createEmptyBuffer:function(w,h){var cvs=document.createElement("canvas");cvs.width=w,cvs.height=h;var ctx=cvs.getContext("2d");return ctx.getImageData(0,0,cvs.width,cvs.height)},crop:function(data,x,y,w,h){return data=this.grab(data,x,y,w,h),this.w=w,this.h=h,data},grab:function(data,x,y,w,h){var tempCvs=Canvas.createEmptyCanvas(this.w,this.h),tempCtx=tempCvs.getContext("2d"),tempIData=tempCtx.createImageData(this.w,this.h);return tempIData.data.set(data),tempCtx.putImageData(tempIData,0,0),tempCtx.getImageData(Math.floor(x),Math.floor(y),Math.floor(w),Math.floor(h)).data},draw:function(srcData,destData,destX,destY,srcW,srcH){var tempCvs=Canvas.createEmptyCanvas(this.w,this.h),tempCtx=tempCvs.getContext("2d"),tempSrcIData=tempCtx.createImageData(srcW,srcH),tempDestIData=tempCtx.createImageData(this.w,this.h);return tempDestIData.data.set(destData),tempCtx.putImageData(tempDestIData,0,0),tempSrcIData.data.set(srcData),tempCtx.putImageData(tempSrcIData,destX,destY),tempCtx.getImageData(0,0,this.w,this.h).data},flipX:function(data,w,h){var i,flip,x,y,c,tempData=this.clone(data);for(y=0;h>y;y++)for(x=0;w>x;x++)for(i=4*(y*w+x),flip=4*(y*w+(w-x-1)),c=0;4>c;c++)tempData[i+c]=data[flip+c];return tempData},flipY:function(data,w,h){var i,flip,x,y,c,tempData=this.clone(data);for(y=0;h>y;y++)for(x=0;w>x;x++)for(i=4*(y*w+x),flip=4*((h-y-1)*w+x),c=0;4>c;c+=1)tempData[i+c]=data[flip+c];return tempData},rotate:function(data,w,h){var i,flip,x,y,c,tempData=this.clone(data);for(y=1;h-1>y;y+=1)for(x=1;w-1>x;x+=1)for(i=4*(y*w+x),flip=4*(x*w+(w-y)),c=0;4>c;c+=1)tempData[i+c]=data[flip+c];return tempData},grayscale:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2],v=.2126*r+.7152*g+.0722*b;data[i]=data[i+1]=data[i+2]=v}return data},monochrome:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2],v=Math.floor((r+g+b)/3);data[i]=data[i+1]=data[i+2]=v>127?255:0,data[i+3]=255}return data},brightness:function(data,adjustment){for(var i=0;i<data.length;i+=4)data[i]+=adjustment,data[i+1]+=adjustment,data[i+2]+=adjustment;return data},threshold:function(data,threshold){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2],v=.2126*r+.7152*g+.0722*b>=threshold?255:0;data[i]=data[i+1]=data[i+2]=v}return data},sepia:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2];data[i]=.393*r+.769*g+.189*b,data[i+1]=.349*r+.686*g+.168*b,data[i+2]=.272*r+.534*g+.131*b}return data},red:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2];data[i]=(r+g+b)/3,data[i+1]=data[i+2]=0}return data},green:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2];data[i+1]=(r+g+b)/3,data[i]=data[i+2]=0}return data},blue:function(data){for(var i=0;i<data.length;i+=4){var r=data[i],g=data[i+1],b=data[i+2];data[i+2]=(r+g+b)/3,data[i]=data[i+1]=0}return data},invert:function(data){for(var i=0;i<data.length;i+=4)data[i]=255-data[i],data[i+1]=255-data[i+1],data[i+2]=255-data[i+2];return data},convolve3x3:function(data,w,m,divisor,offset){divisor||(divisor=m.reduce(function(a,b){return a+b})||1);for(var newData=new Uint8ClampedArray(data.length),len=newData.length,res=0,i=0;len>i;i++)if((i+1)%4!==0){res=0;for(var these=[data[i-4*w-4]||data[i],data[i-4*w]||data[i],data[i-4*w+4]||data[i],data[i-4]||data[i],data[i],data[i+4]||data[i],data[i+4*w-4]||data[i],data[i+4*w]||data[i],data[i+4*w+4]||data[i]],j=0;9>j;j++)res+=these[j]*m[j];res/=divisor,offset&&(res+=offset),newData[i]=res}else newData[i]=data[i];return newData},sobel:function(data,w){for(var grayscale=this.grayscale(data),vertical=this.convolve3x3(grayscale,w,[-1,0,1,-2,0,2,-1,0,1]),horizontal=this.convolve3x3(grayscale,w,[-1,-2,-1,0,0,0,1,2,1]),newData=new Uint8ClampedArray(data.length),i=0;i<data.length;i+=4){var v=Math.abs(vertical[i]);newData[i]=v;var h=Math.abs(horizontal[i]);newData[i+1]=h,newData[i+2]=(v+h)/4,newData[i+3]=255}return newData},convolute:function(data,w,h,weights,opaque){for(var side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),dst=new Uint8ClampedArray(data.length),alphaFac=opaque?1:0,y=0;h>y;y++)for(var x=0;w>x;x++){for(var sy=y,sx=x,dstOff=4*(y*w+x),r=0,g=0,b=0,a=0,cy=0;side>cy;cy++)for(var cx=0;side>cx;cx++){var scy=sy+cy-halfSide,scx=sx+cx-halfSide;if(scy>=0&&h>scy&&scx>=0&&w>scx){var srcOff=4*(scy*w+scx),wt=weights[cy*side+cx];r+=data[srcOff]*wt,g+=data[srcOff+1]*wt,b+=data[srcOff+2]*wt,a+=data[srcOff+3]*wt}}dst[dstOff]=r,dst[dstOff+1]=g,dst[dstOff+2]=b,dst[dstOff+3]=a+alphaFac*(255-a)}return dst},setMixPixel:function(data,x,y,blendColor){var oc=this.getPixelXY(data,x,y),n=blendColor[3]/255,n2=1-n;this.setPixelXY(data,x,y,[Math.floor(oc[0]*n2+blendColor[0]*n),Math.floor(oc[1]*n2+blendColor[1]*n),Math.floor(oc[2]*n2+blendColor[2]*n),oc[3]])},mixColors:function(color1,color2,percent){var n=percent||.5,R=Math.round((color2[0]-color1[0])*n)+color1[0],G=Math.round((color2[1]-color1[1])*n)+color1[1],B=Math.round((color2[2]-color1[2])*n)+color1[2],A=Math.round((color2[3]-color1[3])*n)+color1[3];return[R,G,B,A]},centerKaleidoskope:function(data,w,h){data=this.grab(data,0,0,2*w,2*h),this.w=2*w,this.h=2*h;var block=this.grab(data,0,0,w,h);return data=this.draw(block,data,0,0,w,h),block=this.flipX(block,w,h),data=this.draw(block,data,w,0,w,h),block=this.flipY(block,w,h),data=this.draw(block,data,w,h,w,h),block=this.flipX(block,w,h),data=this.draw(block,data,0,h,w,h)},centerOutsideKaleidoskope:function(data,w,h){data=this.grab(data,0,0,2*w,2*h),this.w=2*w,this.h=2*h;var block=this.grab(data,0,0,w,h);return data=this.draw(block,data,0,0,w,h),block=this.flipY(block,w,h),data=this.draw(block,data,w,0,w,h),block=this.flipX(block,w,h),data=this.draw(block,data,w,h,w,h),block=this.flipY(block,w,h),data=this.draw(block,data,0,h,w,h)},outsideKaleidoskope:function(data,w,h){data=this.grab(data,0,0,2*w,2*h),this.w=2*w,this.h=2*h;var block=this.grab(data,0,0,w,h);return block=this.flipX(block,w,h),data=this.draw(block,data,0,0,w,h),block=this.flipX(block,w,h),data=this.draw(block,data,w,0,w,h),block=this.flipY(block,w,h),data=this.draw(block,data,w,h,w,h),block=this.flipX(block,w,h),data=this.draw(block,data,0,h,w,h)},vertKaleidoskope:function(data,w,h){data=this.grab(data,0,0,2*w,2*h),this.w=2*w,this.h=2*h;var block=this.grab(data,0,0,this.w,h);return data=this.draw(block,data,0,0,this.w,h),block=this.flipY(block,this.w,h),data=this.draw(block,data,0,h,this.w,h)},cardKaleidoskope:function(data,w,h){data=this.grab(data,0,0,2*w,2*h),this.w=2*w,this.h=2*h;var block=this.grab(data,0,0,this.w,h);return data=this.draw(block,data,0,0,this.w,h),block=this.flipY(block,this.w,h),block=this.flipX(block,this.w,h),data=this.draw(block,data,0,h,this.w,h)},horizKaleidoskope:function(data,w,h){data=this.grab(data,0,0,2*w,2*h),this.w=2*w,this.h=2*h;var block=this.grab(data,0,0,w,this.h);return data=this.draw(block,data,0,0,w,this.h),block=this.flipX(block,w,this.h),data=this.draw(block,data,w,0,w,this.h)},format:function(){for(var theString=arguments[0],i=1;i<arguments.length;i++){var regEx=new RegExp("\\{"+(i-1)+"\\}","gm");theString=theString.replace(regEx,arguments[i])}return theString},ucfirst:function(str){return str.length&&(str=str.charAt(0).toUpperCase()+str.slice(1)),str},buildDitherList:function(){var options=[{text:"Нет"}];return _.each(Dithering.PALETTE,function(obj,keyP){var nameP=obj.name;_.each(Dithering.ALGORITHM,function(nameA,keyA){options.push({text:this.format("{0} ({1})",nameP,nameA),cb:this[this.format("dither{0}_{1}",keyP,keyA)]})},this)},this),options},ditherC64_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.C64,algorithm:Dithering.ALGORITHM.REDUCE})},ditherC64_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.C64,algorithm:Dithering.ALGORITHM.ORDERED})},ditherC64_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.C64,algorithm:Dithering.ALGORITHM.ERROR})},ditherC64_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.C64,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherSPECTRUM_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.SPECTRUM,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherSPECTRUM_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.SPECTRUM,algorithm:Dithering.ALGORITHM.REDUCE})},ditherSPECTRUM_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.SPECTRUM,algorithm:Dithering.ALGORITHM.ORDERED})},ditherSPECTRUM_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.SPECTRUM,algorithm:Dithering.ALGORITHM.ERROR})},ditherAMIGA_BRONZE_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_BRONZE,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherAMIGA_BRONZE_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_BRONZE,algorithm:Dithering.ALGORITHM.REDUCE})},ditherAMIGA_BRONZE_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_BRONZE,algorithm:Dithering.ALGORITHM.ORDERED})},ditherAMIGA_BRONZE_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_BRONZE,algorithm:Dithering.ALGORITHM.ERROR})},ditherMONO_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.MONO,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherMONO_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.MONO,algorithm:Dithering.ALGORITHM.REDUCE})},ditherMONO_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.MONO,algorithm:Dithering.ALGORITHM.ORDERED})},ditherMONO_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.MONO,algorithm:Dithering.ALGORITHM.ERROR})},ditherAMIGA_ORANGE_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_ORANGE,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherAMIGA_ORANGE_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_ORANGE,algorithm:Dithering.ALGORITHM.REDUCE})},ditherAMIGA_ORANGE_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_ORANGE,algorithm:Dithering.ALGORITHM.ORDERED})},ditherAMIGA_ORANGE_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.AMIGA_ORANGE,algorithm:Dithering.ALGORITHM.ERROR})},ditherBASIC_ATKINSON:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.BASIC,algorithm:Dithering.ALGORITHM.ATKINSON})},ditherBASIC_REDUCE:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.BASIC,algorithm:Dithering.ALGORITHM.REDUCE})},ditherBASIC_ORDERED:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.BASIC,algorithm:Dithering.ALGORITHM.ORDERED})},ditherBASIC_ERROR:function(data,w,h){return Dithering.dither(data,w,h,{palette:Dithering.PALETTE.BASIC,algorithm:Dithering.ALGORITHM.ERROR})},cbMirrorX:function(data,w,h){return this.flipX(data,w,h)},cbMirrorY:function(data,w,h){return this.flipY(data,w,h)},cbMirrorXY:function(data,w,h){return this.flipY(this.flipX(data,w,h),w,h)},applyPost:function(out,options,tilesW,tilesH){return 0===Object.getOwnPropertyNames(options).length?out:(_.each(Object.keys(options),function(key){out=this["post"+this.ucfirst(key)](options,out,tilesW,tilesH)},this),out)},postMirror:function(options,out){return options.mirror&&this.options.mirror.options[options.mirror].cb&&this.options.mirror.options[options.mirror]&&(out=this.options.mirror.options[options.mirror].cb.call(this,out,this.w,this.h)),out},postInvert:function(options,out){return parseInt(options.invert)&&(out=this.invert(out)),out},postDither:function(options,out){return options.dither&&this.options.dither.options[options.dither].cb&&this.options.dither.options[options.dither]&&(out=this.options.dither.options[options.dither].cb.call(this,out,this.w,this.h)),out},postThin:function(options,out){return parseInt(options.thin)&&(out=this.convolute(out,this.w,this.h,[1,1,1,1,-7,1,1,1,1])),out},postZhangSuen:function(options,out){return parseInt(options.zhangSuen)&&(out=this.zhangSuen(out,this.w,this.h)),out},postSobel:function(options,out){return parseInt(options.sobel)&&(out=this.sobel(out,this.w)),out},postEmboss:function(options,out){if(parseInt(options.emboss)){var eFac=parseInt(options.emboss),eMtx=[];switch(eFac){case 1:eMtx=[1,1,-1,1,3,-1,1,-1,-1];break;case 2:eMtx=[2,0,0,0,-1,0,0,0,-1]}out=this.convolve3x3(out,this.w,eMtx)}return out},postEdge:function(options,out){if(parseInt(options.edge)){var edFac=parseInt(options.edge),edMtx=[];switch(edFac){case 1:edMtx=[1,1,1,1,-7,1,1,1,1];break;case 2:edMtx=[-5,0,0,0,0,0,0,0,5]}out=this.convolve3x3(out,this.w,edMtx)}return out},postSharpen:function(options,out){if(parseInt(options.sharpen)){var sFac=parseInt(options.sharpen),sMtx=[];2>sFac?(sFac+=4,sMtx=[0,-1,0,-1,sFac,-1,0,-1,0]):(sFac+=7,sMtx=[-1,-1,-1,-1,sFac,-1,-1,-1,-1]),out=this.convolute(out,this.w,this.h,sMtx)}return out},postBlur:function(options,out){if(parseInt(options.blur)){var bFac=parseInt(options.blur)+7;out=this.convolute(out,this.w,this.h,[1/bFac,1/bFac,1/bFac,1/bFac,1/bFac,1/bFac,1/bFac,1/bFac,1/bFac])}return out},postThreshold:function(options,out){return parseInt(options.threshold)&&this.options.threshold.cb&&(out=this.options.threshold.cb.call(this,out,parseInt(options.threshold))),out},postBrightness:function(options,out){return parseInt(options.brightness)&&this.options.brightness.cb&&(out=this.options.brightness.cb.call(this,out,parseInt(options.brightness))),out},postColors:function(options,out){return options.colors&&this.options.colors.options[options.colors].cb&&this.options.colors.options[options.colors]&&(out=this.options.colors.options[options.colors].cb.call(this,out)),out},postKaleidoscope:function(options,out,tilesW,tilesH){return options.kaleidoscope&&this.options.kaleidoscope.options[options.kaleidoscope].cb&&this.options.kaleidoscope.options[options.kaleidoscope]&&(out=this.options.kaleidoscope.options[options.kaleidoscope].cb.call(this,out,Math.floor(tilesW/2)*this.TILE_WIDTH,Math.floor(tilesH/2)*this.TILE_HEIGHT)),out}})}),define("models/TriangleBlocks",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Blocks",description:"Blocks Tile",sort:150}),TILE_WIDTH:5,TILE_HEIGHT:5,getColors:function(data,x,y){var f,colors=[];return colors[5]=this.getPixelXY(data,x+Math.floor((this.TILE_WIDTH-1)/2),y+Math.floor((this.TILE_HEIGHT-1)/2)),f=.75,colors[2]=this.mixColors(colors[5],this.COLORS.BLACK,f),colors[3]=this.mixColors(colors[5],this.COLORS.WHITE,f),f=.125,colors[4]=this.mixColors(colors[5],this.COLORS.WHITE,f),colors[6]=this.mixColors(colors[5],this.COLORS.BLACK,f),f=.25,colors[7]=this.mixColors(colors[5],this.COLORS.BLACK,f),colors},pattern:[[5,2,2,2,2],[2,3,4,4,5],[2,4,5,5,6],[2,4,5,5,6],[2,5,6,6,7]]})}),define("models/TriangleCross",["backbone","underscore","models/TriangleAbstract"],function(Backbone,_,TriangleAbstractModel){
"use strict";return TriangleAbstractModel.extend({defaults:_.extend({},TriangleAbstractModel.prototype.defaults,{name:"Triangle Cross",description:"Triangle Cross Filter",sort:10}),pattern:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[4,4,1,1,1,1,1,1,1,1,1,1,1,1,2,2],[4,4,4,1,1,1,1,1,1,1,1,1,1,2,2,2],[4,4,4,4,1,1,1,1,1,1,1,1,2,2,2,2],[4,4,4,4,4,1,1,1,1,1,1,2,2,2,2,2],[4,4,4,4,4,4,1,1,1,1,2,2,2,2,2,2],[4,4,4,4,4,4,4,1,1,2,2,2,2,2,2,2],[4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2],[4,4,4,4,4,4,4,3,3,2,2,2,2,2,2,2],[4,4,4,4,4,4,3,3,3,3,2,2,2,2,2,2],[4,4,4,4,4,3,3,3,3,3,3,2,2,2,2,2],[4,4,4,4,3,3,3,3,3,3,3,3,2,2,2,2],[4,4,4,3,3,3,3,3,3,3,3,3,3,2,2,2],[4,4,3,3,3,3,3,3,3,3,3,3,3,3,2,2],[4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2]],TILE_WIDTH:16,TILE_HEIGHT:16,getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT/4),colors[2]=this.getPixelXY(data,x+this.TILE_WIDTH-this.TILE_WIDTH/4,y+this.TILE_HEIGHT/2),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT-this.TILE_HEIGHT/4),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/4,y+this.TILE_HEIGHT/2),colors},doit:function(data,w,h){var options=this.readOptions();this.w=w,this.h=h;var src=new Uint8ClampedArray(data.data),tilesW=Math.floor(this.w/this.TILE_WIDTH),tilesH=Math.floor(this.h/this.TILE_HEIGHT),newW=tilesW*this.TILE_WIDTH,newH=tilesH*this.TILE_HEIGHT;src=this.crop(src,0,0,newW,newH);var colors,x,y,px,py,out=new Uint8ClampedArray(src.length),pattern=_.isFunction(this.pattern)?this.pattern():this.pattern;for(x=0;newW>x;x+=this.TILE_WIDTH)for(y=0;newH>y;y+=this.TILE_HEIGHT)for(colors=this.getColors(src,x,y),px=0;px<this.TILE_WIDTH;px++)for(py=0;py<this.TILE_WIDTH;py++)pattern[py][px]&&this.setPixelXY(out,x+px,y+py,colors[pattern[py][px]]);return out=this.applyPost(out,options,tilesW,tilesH),{data:out,w:this.w,h:this.h}}})}),define("models/TriangleCrossRadial",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Triangle Cross Radial",description:"Triangle Cross Radial Filter",sort:20}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x+2,y+2),colors[3]=this.getPixelXY(data,x+4,y+4),colors[4]=this.getPixelXY(data,x+6,y+6),colors},pattern:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1],[1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1],[1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1],[1,1,2,2,3,3,4,4,4,4,3,3,2,2,1,1],[1,1,2,2,3,3,4,4,4,4,3,3,2,2,1,1],[1,1,2,2,3,3,4,4,4,4,3,3,2,2,1,1],[1,1,2,2,3,3,4,4,4,4,3,3,2,2,1,1],[1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1],[1,1,2,2,3,3,3,3,3,3,3,3,2,2,1,1],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]})}),define("models/TriangleCube",["backbone","underscore","models/TriangleAbstract"],function(Backbone,_,TriangleAbstractModel){"use strict";return TriangleAbstractModel.extend({defaults:_.extend({},TriangleAbstractModel.prototype.defaults,{name:"Triangle Cube",description:"Triangle Cube Filter",sort:100}),TILE_WIDTH:21,TILE_HEIGHT:21,doit:function(data,w,h){var options=this.readOptions();this.w=w,this.h=h;for(var out=new Uint8ClampedArray(data.data),tilesW=Math.floor(this.w/this.TILE_WIDTH),tilesH=Math.floor(this.h/this.TILE_HEIGHT),pattern=[[0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0],[0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0],[0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5],[4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,5,5],[4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,5,5,5,5,5],[4,4,4,4,4,4,4,4,3,3,3,3,3,3,5,5,5,5,5,5,5],[4,4,4,4,4,4,4,4,4,4,3,3,5,5,5,5,5,5,5,5,5],[4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5],[4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5],[4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5],[4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5],[4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5],[0,0,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,0],[0,0,0,0,4,4,4,4,4,4,4,5,5,5,5,5,5,5,0,0,0],[0,0,0,0,0,0,4,4,4,4,4,5,5,5,5,5,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,4,4,5,5,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,5,0,0,0,0,0,0,0,0,0]],border=[[0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],[0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],[0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0]],hot=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0],[0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0],[0,0,0,0,0,0,2,2,0,0,0,0,0,0,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,2,0,0,2,2,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],spark=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,8,8,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],top=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,6,6,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0],[0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0],[0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0],[0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0],[0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0],[0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0],[0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0],[0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],shadow=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],step=0,border_c=[0,0,0,196],hot_c=[255,255,255,128],top_c=[255,255,255,128],shadow_c=[0,0,0,128],spark_c=[255,255,255,255],y=-this.TILE_HEIGHT;y<this.h;y+=this.TILE_HEIGHT-6){for(var x=-this.TILE_WIDTH;x<this.w;x+=this.TILE_WIDTH-1){var colors=[];colors[1]=border_c,colors[2]=hot_c;var x3=parseInt(x+this.TILE_WIDTH/2);x3=x3>this.w?this.w:x3,x3=0>x3?0:x3,colors[3]=this.getPixelXY(data.data,x3,y+3);var x4=x+5;x4=x4>this.w?this.w:x4,x4=0>x4?0:x4;var y4=y+11;y4=y4>this.h?this.h:y4,colors[4]=this.getPixelXY(data.data,x4,y4);var x5=x+14;x5=x5>this.w?this.w:x5,x5=0>x5?0:x5;var y5=y+11;y5=y5>this.h?this.h:y5,colors[5]=this.getPixelXY(data.data,x5,y5),colors[6]=top_c,colors[7]=shadow_c,colors[8]=spark_c;var offsetX=0;1==step&&(offsetX=10);for(var px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(var py=0;py<this.TILE_HEIGHT;py++)pattern[py][px]&&this.setPixelXY(out,x+px+offsetX,y+py,colors[pattern[py][px]]);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)hot[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,hot_c);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)top[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,top_c);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)shadow[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,shadow_c);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)spark[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,spark_c);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)border[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,border_c)}step=1==step?0:1}return out=this.applyPost(out,options,tilesW,tilesH),{data:out,w:this.w,h:this.h}}})}),define("models/TriangleCubeSimple",["backbone","underscore","models/TriangleAbstract"],function(Backbone,_,TriangleAbstractModel){"use strict";return TriangleAbstractModel.extend({defaults:_.extend({},TriangleAbstractModel.prototype.defaults,{name:"Triangle Cube Simple",description:"Triangle Cube Simple Filter",sort:110}),TILE_WIDTH:21,TILE_HEIGHT:21,doit:function(data,w,h){var options=this.readOptions();this.w=w,this.h=h;for(var out=new Uint8ClampedArray(data.data),tilesW=Math.floor(this.w/this.TILE_WIDTH),tilesH=Math.floor(this.h/this.TILE_HEIGHT),pattern=[[0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0],[0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0],[0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0],[0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0],[0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0]],border=[[0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],[0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],[0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0]],hot=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0],[0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0],[0,0,0,0,0,0,2,2,0,0,0,0,0,0,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,2,0,0,2,2,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],spark=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,8,8,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],top=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,6,6,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0],[0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0],[0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0],[0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0],[0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0],[0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0],[0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0],[0,0,0,0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],shadow=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,7,7,7,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],step=0,border_c=[0,0,0,196],hot_c=[255,255,255,128],top_c=[255,255,255,128],shadow_c=[0,0,0,128],spark_c=[255,255,255,255],y=-this.TILE_HEIGHT;y<this.h;y+=this.TILE_HEIGHT-6){for(var x=-this.TILE_WIDTH;x<this.w;x+=this.TILE_WIDTH-1){var colors=[];colors[1]=border_c,colors[2]=hot_c;var x3=parseInt(x+this.TILE_WIDTH/2);x3=x3>this.w?this.w:x3,x3=0>x3?0:x3;var y3=parseInt(y+this.TILE_HEIGHT/2);y3=y3>this.h?this.h:y3,colors[3]=this.getPixelXY(data.data,x3,y3),colors[6]=top_c,colors[7]=shadow_c,colors[8]=spark_c;var offsetX=0;1==step&&(offsetX=10);for(var px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(var py=0;py<this.TILE_HEIGHT;py++)pattern[py][px]&&this.setPixelXY(out,x+px+offsetX,y+py,colors[pattern[py][px]]);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)hot[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,hot_c);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)top[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,top_c);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)shadow[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,shadow_c);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)spark[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,spark_c);for(px=0;px<this.TILE_WIDTH;px++)if(!(x+px+offsetX>this.w||0>x+px+offsetX))for(py=0;py<this.TILE_HEIGHT;py++)border[py][px]&&this.setMixPixel(out,x+px+offsetX,y+py,border_c)}step=1==step?0:1}return out=this.applyPost(out,options,tilesW,tilesH),{data:out,w:this.w,h:this.h}}})}),define("models/TriangleDithering",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Triangle Dither",description:"Triangle Dither Filter",sort:30}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x,y+4),colors[3]=this.getPixelXY(data,x,y+8),colors[4]=this.getPixelXY(data,x,y+12),colors},pattern:[[1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1],[1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2],[1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1],[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],[2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],[2,1,2,2,2,1,2,2,2,1,2,2,2,1,2,2],[2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,1],[2,1,2,2,2,1,2,2,2,1,2,2,2,1,2,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,1]]})}),define("models/TriangleKuwahara",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Плавная пикселизация",description:"Kuwahara Tile",sort:130}),TILE_WIDTH:5,TILE_HEIGHT:5,getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x+4,y),colors[3]=this.getPixelXY(data,x,y+4),colors[4]=this.getPixelXY(data,x+4,y+4),colors[5]=this.mixColors(colors[1],colors[2]),colors[6]=this.mixColors(colors[1],colors[3]),colors[7]=this.mixColors(colors[2],colors[4]),colors[8]=this.mixColors(colors[3],colors[4]),colors[9]=this.mixColors(colors[5],colors[8]),colors[10]=this.mixColors(colors[6],colors[5]),colors[11]=this.mixColors(colors[5],colors[7]),colors[12]=this.mixColors(colors[6],colors[8]),colors[13]=this.mixColors(colors[7],colors[8]),colors},pattern:[[1,1,5,2,2],[1,10,5,11,2],[6,6,9,7,7],[3,12,8,13,4],[3,3,8,4,4]]})}),define("models/TriangleLine",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Triangle Line",description:"Triangle Line Filter",sort:40}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x,y+4),colors[3]=this.getPixelXY(data,x,y+8),colors[4]=this.getPixelXY(data,x,y+12),colors},pattern:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]]})}),define("models/TriangleMeander",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Меандр",description:"Meander Pattern",sort:50}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x,y+8),colors},pattern:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,1,1,1,1,1,1,1,1,2,2,2,1],[1,2,2,2,1,2,2,2,2,2,2,1,2,2,2,1],[1,2,2,2,1,2,2,2,2,2,2,1,2,2,2,1],[1,2,2,2,1,1,1,1,2,2,2,1,2,2,2,1],[1,2,2,2,2,2,2,1,2,2,2,1,2,2,2,1],[1,2,2,2,2,2,2,1,2,2,2,1,2,2,2,1],[1,2,2,2,2,2,2,1,2,2,2,1,2,2,2,1],[1,1,1,1,1,1,1,1,2,2,2,1,2,2,2,1],[2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1],[2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1],[2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,1]]})}),define("models/TrianglePeecol",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Peecol",description:"Peecol Tile",sort:140}),TILE_WIDTH:36,TILE_HEIGHT:36,getColors:function(data,x,y){var colors=[];colors[1]=this.COLORS.BLACK,colors[2]=this.getPixelXY(data,x-1,y),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y),colors[4]=this.getPixelXY(data,x-1,y+this.TILE_HEIGHT-1),colors[5]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1),colors[6]=this.getPixelXY(data,x-1,y+4),colors[7]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+4),colors[8]=this.getPixelXY(data,x-1,y+this.TILE_HEIGHT-1-4),colors[9]=this.getPixelXY(data,x,y+Math.floor((this.TILE_HEIGHT-1)/2)),colors[10]=this.getPixelXY(data,x-1,y+12),colors[11]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+12),colors[12]=this.getPixelXY(data,x-1,y+this.TILE_HEIGHT-1-12),colors[13]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1-12),colors[14]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1-4),colors[15]=this.getPixelXY(data,x+7,y+7),colors[16]=this.getPixelXY(data,x+this.TILE_WIDTH-1-7,y+7),colors[17]=this.getPixelXY(data,x+7,y+this.TILE_HEIGHT-1-7),colors[18]=this.getPixelXY(data,x+this.TILE_WIDTH-1-7,y+this.TILE_HEIGHT-1-7);var f=.25;return colors[19]=this.mixColors(colors[6],this.COLORS.BLACK,f),colors[20]=this.mixColors(colors[8],this.COLORS.BLACK,f),colors[21]=this.mixColors(colors[7],this.COLORS.BLACK,f),colors[22]=this.mixColors(colors[14],this.COLORS.BLACK,f),colors[23]=this.mixColors(colors[9],this.COLORS.BLACK,f),colors[24]=colors[9],colors[25]=this.getPixelXY(data,x+Math.floor((this.TILE_WIDTH-1)/2),y+Math.floor((this.TILE_HEIGHT-1)/2)),colors[26]=this.mixColors(colors[9],this.COLORS.WHITE,f),colors[27]=this.mixColors(colors[6],this.COLORS.WHITE,f),colors[28]=this.mixColors(colors[8],this.COLORS.WHITE,f),colors[29]=this.mixColors(colors[7],this.COLORS.WHITE,f),colors[30]=this.mixColors(colors[14],this.COLORS.WHITE,f),colors},pattern:[[2,1,19,27,6,1,2,2,2,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,3,3,3,1,7,29,21,1,3],[1,1,19,27,6,1,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,1,7,29,21,1,1],[19,19,19,27,6,1,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,1,7,29,21,21,21],[27,27,27,27,6,1,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,1,7,29,29,29,29],[6,6,6,6,6,1,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,1,7,7,7,7,7],[1,1,1,1,1,15,15,15,15,1,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,1,16,16,16,16,1,1,1,1,1],[2,15,15,15,15,15,15,15,1,10,10,10,10,10,1,24,26,26,26,26,24,1,11,11,11,11,11,1,16,16,16,16,16,16,16,3],[2,15,15,15,15,15,15,1,10,10,10,10,10,10,1,23,9,9,9,9,23,1,11,11,11,11,11,11,1,16,16,16,16,16,16,3],[2,15,15,15,15,15,1,10,10,10,10,10,10,1,23,9,9,9,9,9,9,23,1,11,11,11,11,11,11,1,16,16,16,16,16,3],[1,1,1,1,1,1,10,10,10,10,10,10,1,23,9,9,9,9,9,9,9,9,23,1,11,11,11,11,11,11,1,1,1,1,1,1],[10,10,10,10,10,10,10,10,10,10,10,1,23,9,9,9,9,9,9,9,9,9,9,23,1,11,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,10,1,23,9,9,9,9,9,9,9,9,9,9,9,9,23,1,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,1,23,9,9,9,9,9,9,9,9,9,9,9,9,9,9,23,1,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,1,23,9,9,9,9,23,23,23,23,23,23,23,23,9,9,9,9,23,1,11,11,11,11,11,11,11,11],[1,1,1,1,1,1,1,1,23,9,9,9,9,23,26,26,26,26,26,26,26,26,23,9,9,9,9,23,1,1,1,1,1,1,1,1],[24,24,24,24,24,24,24,23,9,9,9,9,9,23,26,23,23,23,23,23,23,26,23,9,9,9,9,9,23,24,24,24,24,24,24,24],[26,26,26,26,26,26,26,9,9,9,9,9,9,23,26,23,25,25,25,25,23,26,23,9,9,9,9,9,9,26,26,26,26,26,26,26],[26,26,26,26,26,26,26,9,9,9,9,9,9,23,26,23,25,25,25,25,23,26,23,9,9,9,9,9,9,26,26,26,26,26,26,26],[26,26,26,26,26,26,26,9,9,9,9,9,9,23,26,23,25,25,25,25,23,26,23,9,9,9,9,9,9,26,26,26,26,26,26,26],[26,26,26,26,26,26,26,9,9,9,9,9,9,23,26,23,25,25,25,25,23,26,23,9,9,9,9,9,9,26,26,26,26,26,26,26],[24,24,24,24,24,24,24,23,9,9,9,9,9,23,26,23,23,23,23,23,23,26,23,9,9,9,9,9,23,24,24,24,24,24,24,24],[1,1,1,1,1,1,1,1,23,9,9,9,9,23,26,26,26,26,26,26,26,26,23,9,9,9,9,23,1,1,1,1,1,1,1,1],[12,12,12,12,12,12,12,12,1,23,9,9,9,9,23,23,23,23,23,23,23,23,9,9,9,9,23,1,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,1,23,9,9,9,9,9,9,9,9,9,9,9,9,9,9,23,1,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,1,23,9,9,9,9,9,9,9,9,9,9,9,9,23,1,13,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,12,1,23,9,9,9,9,9,9,9,9,9,9,23,1,13,13,13,13,13,13,13,13,13,13,13],[1,1,1,1,1,1,12,12,12,12,12,12,1,23,9,9,9,9,9,9,9,9,23,1,13,13,13,13,13,13,1,1,1,1,1,1],[4,17,17,17,17,17,1,12,12,12,12,12,12,1,23,9,9,9,9,9,9,23,1,13,13,13,13,13,13,1,18,18,18,18,18,5],[4,17,17,17,17,17,17,1,12,12,12,12,12,12,1,23,9,9,9,9,23,1,13,13,13,13,13,13,1,18,18,18,18,18,18,5],[4,17,17,17,17,17,17,17,1,12,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,13,1,18,18,18,18,18,18,18,5],[1,1,1,1,1,17,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,18,1,1,1,1,1],[8,8,8,8,8,1,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,1,14,14,14,14,14],[28,28,28,28,8,1,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,1,14,30,30,30,30],[20,20,20,28,8,1,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,1,14,30,22,22,22],[1,1,20,28,8,1,17,17,17,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,18,18,18,1,14,30,22,1,1],[4,1,20,28,8,1,4,4,4,1,12,12,12,12,1,24,26,26,26,26,24,1,13,13,13,13,1,5,5,5,1,14,30,22,1,5]]})}),define("models/TriangleRealCross",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Triangle Real Cross",description:"Triangle Real Cross Filter",sort:60}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x+2,y+2),colors[3]=this.getPixelXY(data,x+4,y+4),colors[4]=this.getPixelXY(data,x+6,y+6),colors},pattern:[[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[2,2,2,2,2,3,3,4,4,3,3,2,2,2,2,2],[2,2,2,2,2,3,3,4,4,3,3,2,2,2,2,2],[3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3],[2,2,2,2,2,3,3,4,4,3,3,2,2,2,2,2],[2,2,2,2,2,3,3,4,4,3,3,2,2,2,2,2],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1],[1,1,1,2,2,3,3,4,4,3,3,2,2,1,1,1]]})}),define("models/TriangleSkull",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Череп",description:"Skull Tile",sort:70}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x,y),colors[2]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+4),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT/2),colors[5]=this.getPixelXY(data,x,y+this.TILE_HEIGHT-1),colors[6]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1),colors},pattern:[[1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3],[1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3],[1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3],[1,1,2,2,2,2,4,4,4,4,2,2,2,2,3,3],[2,2,2,2,2,4,4,4,4,4,4,2,2,2,2,2],[2,2,2,2,4,4,4,4,4,4,4,4,2,2,2,2],[2,2,2,2,4,4,2,4,4,2,4,4,2,2,2,2],[2,2,2,2,4,4,2,4,4,2,4,4,2,2,2,2],[2,2,2,2,4,4,4,4,4,4,4,4,2,2,2,2],[2,2,2,2,4,4,4,4,4,4,4,4,2,2,2,2],[2,2,2,2,2,2,4,4,4,4,2,2,2,2,2,2],[5,5,2,2,2,2,4,4,4,4,2,2,2,2,6,6],[5,5,5,2,2,2,2,2,2,2,2,2,2,6,6,6],[5,5,5,5,2,2,2,2,2,2,2,2,6,6,6,6],[5,2,5,5,2,2,2,2,2,2,2,2,6,6,2,6],[5,2,5,5,2,2,2,2,2,2,2,2,6,6,2,6]]})}),define("models/TriangleStart",["backbone","underscore","models/TriangleAbstract"],function(Backbone,_,TriangleAbstractModel){"use strict";return TriangleAbstractModel.extend({defaults:_.extend({},TriangleAbstractModel.prototype.defaults,{name:"Тождество",description:"Start Filter",sort:0}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT/4),colors[2]=this.getPixelXY(data,x+this.TILE_WIDTH-this.TILE_WIDTH/4,y+this.TILE_HEIGHT/2),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT-this.TILE_HEIGHT/4),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/4,y+this.TILE_HEIGHT/2),colors},postKaleidoscope:function(options,out){return options.kaleidoscope&&this.options.kaleidoscope.options[options.kaleidoscope].cb&&this.options.kaleidoscope.options[options.kaleidoscope]&&(out=this.options.kaleidoscope.options[options.kaleidoscope].cb.call(this,out,Math.floor(this.w/2),Math.floor(this.h/2))),out},doit:function(data,w,h){var options=this.readOptions();this.w=w,this.h=h;var out=this.applyPost(data.data,options);

return{data:out,w:this.w,h:this.h}}})}),define("models/TriangleStone",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Stone",description:"Stone Tile",sort:80}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x+1,y+1),colors[2]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT-1),colors},pattern:[[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,2,2,1,2,2,2,1,2,2,2,2,2,1,2],[1,1,1,2,1,2,1,2,1,2,1,1,1,2,1,2],[2,2,2,2,1,2,2,2,1,2,2,2,2,2,1,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,1],[2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2]]})}),define("models/TriangleStoneAdvanced",["backbone","underscore","models/TriangleCross"],function(Backbone,_,TriangleCrossModel){"use strict";return TriangleCrossModel.extend({defaults:_.extend({},TriangleCrossModel.prototype.defaults,{name:"Stone Advanced",description:"Advanced Stone Tile",sort:90}),getColors:function(data,x,y){var colors=[];return colors[1]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT/2),colors[2]=this.getPixelXY(data,x,y),colors[3]=this.getPixelXY(data,x+this.TILE_WIDTH/4,y),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y),colors[4]=this.getPixelXY(data,x+this.TILE_WIDTH/4*3,y),colors[5]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y),colors[6]=this.getPixelXY(data,x,y+this.TILE_HEIGHT/4),colors[7]=this.getPixelXY(data,x+this.TILE_WIDTH/2-1,y+this.TILE_HEIGHT/2-1),colors[8]=this.getPixelXY(data,x+this.TILE_WIDTH/4*3,y+this.TILE_HEIGHT/2-1),colors[9]=this.getPixelXY(data,x+this.TILE_WIDTH-1,y+this.TILE_HEIGHT/2-1),colors[10]=this.getPixelXY(data,x,y+this.TILE_HEIGHT/4*3),colors[11]=this.getPixelXY(data,x+this.TILE_HEIGHT/4,y+this.TILE_HEIGHT/4*3),colors[12]=this.getPixelXY(data,x+this.TILE_HEIGHT/2,y+this.TILE_HEIGHT/4*3),colors[13]=this.getPixelXY(data,x+this.TILE_HEIGHT/4*3,y+this.TILE_HEIGHT/4*3),colors[14]=this.getPixelXY(data,x,y+this.TILE_HEIGHT-1),colors[15]=this.getPixelXY(data,x+this.TILE_WIDTH/4,y+this.TILE_HEIGHT-1),colors[16]=this.getPixelXY(data,x+this.TILE_WIDTH/2,y+this.TILE_HEIGHT-1),colors[17]=this.getPixelXY(data,x+this.TILE_WIDTH/4*3,y+this.TILE_HEIGHT-1),colors},pattern:[[1,1,2,1,3,1,1,1,3,1,4,1,4,1,5,1],[1,1,2,1,3,1,1,1,3,1,4,1,4,1,5,1],[1,1,2,1,3,1,1,1,3,1,4,1,4,1,5,1],[2,2,2,1,3,3,3,3,3,1,4,4,4,1,5,5],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[6,6,6,6,1,7,7,7,1,8,8,8,8,8,1,9],[1,1,1,6,1,7,1,7,1,8,1,1,1,8,1,9],[6,6,6,6,1,7,7,7,1,8,8,8,8,8,1,9],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[10,10,10,1,11,11,11,11,11,1,12,12,12,1,13,13],[1,1,10,1,11,1,1,1,11,1,12,1,12,1,13,1],[1,1,10,1,11,1,1,1,11,1,12,1,12,1,13,1],[1,1,10,1,11,1,1,1,11,1,12,1,12,1,13,1],[10,10,10,1,11,11,11,11,11,1,12,12,12,1,13,13],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[14,14,14,1,15,15,15,15,15,1,16,16,16,1,17,17]]})}),define("collections/Generator",["backbone"],function(Backbone){"use strict";return Backbone.Collection.extend({comparator:"sort",doit:function(cid,data,w,h){return this.get({cid:cid}).doit(data,w,h)}})}),define("views/Wizard",["backbone","jquery","underscore","templates","lib/Canvas","sortable"],function(Backbone,$,_,templates,Canvas,Sortable){"use strict";return Backbone.View.extend({el:"#wizard",encoded:null,imageName:null,elements:[],filterCid:null,initialize:function(){this.elements.preloader=this.$(".preloader"),this.elements.error=this.$(".error400"),this.elements.srcImage=this.$(".src-image"),this.elements.dstImage=this.$(".dst-image"),this.elements.inputFilter=this.$("#input-filter"),this.elements.optionsModal=this.$("#options-modal"),this.elements.optionsForm=this.$("#options-form"),this.elements.messageModal=this.$("#message"),this.elements.filterOptionsBtn=this.$("#filter-options"),this.elements.save=this.$("#output-save"),this.collection.each(function(generator){this.elements.inputFilter.append($("<option/>",{value:generator.cid,text:generator.get("name")}))},this);var selectedFilter=this.getSelectedFilter();selectedFilter&&this.elements.inputFilter.val(selectedFilter),this.filterCid=this.elements.inputFilter.val(),this.filterChanged();var encoded=this.getEncoded();encoded&&(this.encoded=encoded,this.elements.srcImage.attr("src",encoded),this.render())},events:{"click #input-url":"selectAll","click #input-url-button":"loadUrl","click #filter-options":"onFilterOptionsClick","click #options-apply":"onOptionsApplyClick","change #input-file":"select","change #input-filter":"onFilterChange"},getSelectedFilter:function(){return localStorage.filter},setSelectedFilter:function(id){localStorage.filter=id},getEncoded:function(){return localStorage.encoded?JSON.parse(localStorage.encoded):null},setEncoded:function(data){localStorage.encoded=JSON.stringify(data)},message:function(msg){this.elements.messageModal.find(".message-body p").text(msg),this.elements.messageModal.modal()},buildOptions:function(model){var options=model.options,html="";return _.each(options,function(o,id){html+=templates.options[o.type]({option:o,id:id,value:localStorage[this.filterCid]?JSON.parse(localStorage[this.filterCid])[id]:null})},this),html},onOptionsApplyClick:function(e){e.preventDefault();var options={};this.elements.optionsModal.find("[data-option]").each(function(){var $e=$(this);options[$e.data("option")]=$e.val()}),localStorage[this.filterCid]=JSON.stringify(options),this.elements.optionsModal.modal("hide"),this.render()},onFilterChange:function(e){this.filterCid=$(e.currentTarget).val(),this.filterChanged()},filterChanged:function(){if(this.filterCid){this.setSelectedFilter(this.filterCid);var model=this.collection.get(this.filterCid),options=model.options;options&&Object.keys(options).length?this.elements.filterOptionsBtn.prop("disabled",!1):this.elements.filterOptionsBtn.prop("disabled",!0),this.render()}else this.elements.filterOptionsBtn.prop("disabled",!0)},onFilterOptionsClick:function(e){e.preventDefault();var model=this.collection.get(this.filterCid);this.elements.optionsModal.find(".modal-title").html(templates.OptionsTitle({name:model.get("name")})),this.elements.optionsModal.find(".description").text(model.get("description"));var form=this.buildOptions(model);this.elements.optionsForm.html(form),this.sortable=Sortable.create(this.elements.optionsForm.get(0),{sort:!0,group:this.filterCid,handle:".drag-handle",animation:150}),localStorage[this.filterCid]&&this.sortable.sort(Object.keys(JSON.parse(localStorage[this.filterCid]))),this.elements.optionsModal.modal()},showPreloader:function(state){state===!0||"undefined"==typeof state?this.elements.preloader.show():this.elements.preloader.fadeOut()},loadUrl:function(e){e.preventDefault();var url=$.trim(this.$("#input-url").val());!url.length||url.length>8190||(this.showPreloader(),$.getJSON("/api.php",{url:url},function(data){0==parseInt(data.error)?(this.elements.srcImage.title=data.name,this.elements.srcImage.attr("src",data.data),this.imageName=data.name,this.encoded=data.data,this.setEncoded(this.encoded),this.render()):this.elements.error.show(),this.showPreloader(!1)}.bind(this)))},selectAll:function(e){$(e.currentTarget).select()},render:function(){if(this.encoded){this.showPreloader(),this.elements.error.hide();var srcImage=this.elements.srcImage[0],cvsIn=Canvas.createEmptyCanvas(srcImage.width,srcImage.height),ctxIn=cvsIn.getContext("2d");ctxIn.drawImage(srcImage,0,0,cvsIn.width,cvsIn.height);var idtIn=ctxIn.getImageData(0,0,cvsIn.width,cvsIn.height),result=this.collection.doit(this.filterCid,idtIn,cvsIn.width,cvsIn.height),cvsOut=Canvas.createEmptyCanvas(result.w,result.h),ctxOut=cvsOut.getContext("2d"),idtOut=ctxOut.createImageData(result.w,result.h);idtOut.data.set(result.data),ctxOut.putImageData(idtOut,0,0),this.outData=cvsOut.toDataURL("image/png"),this.elements.dstImage.attr("src",this.outData);var d=new Date,name="pixla_"+d.getDate()+"-"+(d.getMonth()+1)+"-"+d.getFullYear()+"_"+d.getHours()+"-"+d.getMinutes()+"-"+d.getSeconds()+".png";this.elements.save.attr("href",this.outData),this.elements.save.attr("download",name),this.showPreloader(!1)}},select:function(event){var selectedFile=event.target.files[0],reader=new FileReader;this.elements.srcImage.title=selectedFile.name,this.imageName=selectedFile.name,reader.onload=function(event){this.elements.srcImage.attr("src",event.target.result),this.encoded=event.target.result,this.setEncoded(this.encoded),this.render()}.bind(this),reader.readAsDataURL(selectedFile)}})}),define("templates",function(require){"use strict";return{OptionsTitle:require("tpl!templates/OptionsTitle.ejs"),options:{Select:require("tpl!templates/options/Select.ejs"),Slider:require("tpl!templates/options/Slider.ejs")}}}),require.config({paths:{underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min",jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min",bootstrap:"//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min",share:"//yastatic.net/share/share",sortable:"//cdnjs.cloudflare.com/ajax/libs/Sortable/1.2.0/Sortable.min"},shim:{underscore:{exports:"_"},backbone:{exports:"Backbone",deps:["jquery","underscore"]},bootstrap:{deps:["jquery"]}},waitSeconds:60}),require(["jquery","models/TriangleStart","models/TriangleCross","models/TriangleCrossRadial","models/TriangleRealCross","models/TriangleCube","models/TriangleCubeSimple","models/TriangleLine","models/TriangleDithering","models/TriangleMeander","models/TriangleSkull","models/TriangleStone","models/TriangleStoneAdvanced","models/TriangleKuwahara","models/TrianglePeecol","models/TriangleBlocks","collections/Generator","views/Wizard","bootstrap","share","lib/Fileinput"],function($,TriangleStartModel,TriangleCrossModel,TriangleCrossRadialModel,TriangleRealCrossModel,TriangleCubeModel,TriangleCubeSimpleModel,TriangleLineModel,TriangleDitheringModel,TriangleMeanderModel,TriangleSkullModel,TriangleStoneModel,TriangleStoneAdvancedModel,TriangleKuwahara,TrianglePeecol,TriangleBlocks,GeneratorCollection,WizardView){"use strict";$(function(){if($(document).on("click","a[href=#]",function(e){e.preventDefault()}),$("footer").css("background-color",$("body > nav").css("background-color")),$("footer *").css("color",$(".navbar-default .navbar-nav > li > a").css("color")),"undefined"==typeof FileReader||!$.isFunction(FileReader))return void $("#old-browser").fadeIn("slow");$('[data-toggle="tooltip"]').tooltip(),$("#wizard").show(),$(":file").filestyle({buttonText:"",buttonName:"btn-primary"});var generators=new GeneratorCollection([new TriangleStartModel,new TriangleCrossModel,new TriangleCrossRadialModel,new TriangleRealCrossModel,new TriangleSkullModel,new TriangleCubeModel,new TriangleCubeSimpleModel,new TriangleLineModel,new TriangleMeanderModel,new TriangleStoneModel,new TriangleStoneAdvancedModel,new TriangleKuwahara,new TrianglePeecol,new TriangleBlocks,new TriangleDitheringModel]);new WizardView({collection:generators})})});